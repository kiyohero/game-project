<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>äººç‹¼ã‚²ãƒ¼ãƒ </title>
  <link rel="stylesheet" href="common.css">
  <script src="common.js" defer></script>
  <style>
    /* ===== å¤‰æ•° ===== */
    :root {
      --bg: #f5f0fa;
      --card: #ffffff;
      --purple: #7c5cbf;
      --purple-dk: #5a3d9e;
      --purple-lt: #a78bbd;
      --text: #2d1f3d;
      --text-sub: #7b6b9a;
      --border: #e0d5f0;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    body.night {
      --bg: #0d0a18;
      --card: #1a1232;
      --text: #e8d5ff;
      --text-sub: #b8a8d0;
      --border: #2a1e4a;
    }

    /* ===== ãƒ™ãƒ¼ã‚¹ ===== */
    html { height: 100%; }
    body {
      background: var(--bg);
      transition: background 0.5s;
      padding: 0;
      user-select: none;
      -webkit-user-select: none;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* ===== ç”»é¢ ===== */
    .screen {
      display: none;
      flex-direction: column;
      min-height: 100svh;
      padding: 20px 16px calc(76px + var(--safe-bottom));
      max-width: 480px;
      margin: 0 auto;
      box-sizing: border-box;
    }
    .screen.active { display: flex; }

    /* ===== å›ºå®šãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ ===== */
    #nav-bar {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      padding: 10px 16px;
      padding-bottom: calc(10px + var(--safe-bottom));
      background: rgba(245, 240, 250, 0.94);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-top: 1.5px solid var(--border);
      z-index: 500;
      display: none;
      transition: background 0.5s, border-color 0.5s;
    }
    body.night #nav-bar {
      background: rgba(13, 10, 24, 0.94);
    }
    #nav-btn {
      width: 100%;
      padding: 17px 20px;
      background: linear-gradient(135deg, var(--purple-lt), var(--purple));
      color: #fff;
      border: none;
      border-radius: 16px;
      font-size: 1.1rem;
      font-weight: 800;
      cursor: pointer;
      min-height: 58px;
      letter-spacing: 0.03em;
      box-shadow: 0 4px 18px rgba(124, 92, 191, 0.38);
      transition: transform 0.1s, opacity 0.2s;
    }
    #nav-btn:active { transform: scale(0.97); }
    #nav-btn:disabled { opacity: 0.38; box-shadow: none; }
    #nav-btn.red {
      background: linear-gradient(135deg, #e57373, #c62828);
      box-shadow: 0 4px 18px rgba(198, 40, 40, 0.38);
    }

    /* ===== è¦‹å‡ºã— ===== */
    h1 {
      font-size: 2.4rem; font-weight: 900;
      color: var(--text); line-height: 1.1; margin: 0;
    }
    h2 {
      font-size: 1.5rem; font-weight: 800;
      color: var(--text); line-height: 1.3; margin: 0 0 6px;
    }
    .sub {
      color: var(--text-sub); font-size: 0.88rem;
      line-height: 1.6; margin: 0;
    }

    /* ===== ã‚«ãƒ¼ãƒ‰ ===== */
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 10px rgba(107, 91, 122, 0.09);
      transition: background 0.5s;
    }

    /* ===== ãƒ©ãƒ™ãƒ« ===== */
    .lbl {
      font-size: 0.72rem; font-weight: 700;
      color: var(--text-sub); letter-spacing: 0.07em;
      text-transform: uppercase; margin-bottom: 10px;
      display: block;
    }

    /* ===== ãƒãƒƒã‚¸ ===== */
    .badge {
      display: inline-flex; align-items: center; gap: 5px;
      background: rgba(124, 92, 191, 0.13);
      color: var(--purple-lt);
      font-size: 0.75rem; font-weight: 700;
      padding: 5px 12px; border-radius: 99px;
      margin-bottom: 10px;
    }

    /* ===== ã‚«ã‚¦ãƒ³ãƒˆãƒœã‚¿ãƒ³ ===== */
    .cnt-row { display: flex; gap: 6px; }
    .cnt-btn {
      flex: 1; padding: 13px 4px;
      background: var(--card); border: 2px solid var(--border);
      border-radius: 12px; font-size: 0.95rem; font-weight: 700;
      color: var(--text-sub); cursor: pointer;
      transition: all 0.15s; min-height: 50px;
    }
    .cnt-btn.sel {
      background: var(--purple); border-color: var(--purple); color: #fff;
    }

    /* ===== åå‰å…¥åŠ› ===== */
    .name-grid { display: flex; flex-direction: column; gap: 12px; }
    .name-wrap { display: flex; align-items: flex-start; gap: 8px; }
    .name-num {
      flex-shrink: 0; width: 22px; text-align: center;
      font-size: 0.72rem; font-weight: 700;
      color: var(--purple-lt); margin-top: 12px;
    }
    .name-fields { display: flex; flex-direction: column; gap: 6px; flex: 1; }
    .name-selects { display: flex; gap: 6px; }
    .name-select {
      flex: 1; padding: 10px 4px;
      border: 2px solid var(--border); border-radius: 10px;
      font-size: 0.82rem; color: var(--text); background: var(--card);
      cursor: pointer; text-align: center;
      transition: border-color 0.2s, background 0.5s, color 0.5s;
    }
    .name-select:focus { outline: none; border-color: var(--purple); }
    .name-cpu-label {
      padding: 11px 10px;
      font-size: 0.85rem; color: var(--text-sub);
      border: 2px solid var(--border); border-radius: 10px;
      background: var(--card); opacity: 0.6;
    }
    .role-row { display: flex; gap: 6px; align-items: center; }
    .role-sel {
      flex: 1; padding: 9px 8px;
      border: 2px solid var(--border); border-radius: 10px;
      font-size: 0.88rem; color: var(--text); background: var(--card);
      cursor: pointer; text-align: center;
      transition: border-color 0.2s, background 0.5s, color 0.5s;
    }
    .role-sel:focus { outline: none; border-color: var(--purple); }

    /* ===== ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ ===== */
    .toggle-row {
      display: flex; align-items: center;
      justify-content: space-between; gap: 12px;
    }
    .toggle-btn {
      flex-shrink: 0; padding: 8px 18px;
      border: 2px solid var(--border); border-radius: 99px;
      font-size: 0.88rem; font-weight: 800;
      background: var(--card); color: var(--text-sub);
      cursor: pointer; transition: all 0.2s;
      min-width: 64px; text-align: center;
    }
    .toggle-btn.on {
      background: var(--purple); border-color: var(--purple); color: #fff;
    }

    /* ===== å½¹è·ãƒãƒƒãƒ— ===== */
    .role-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .role-chip {
      padding: 6px 13px; border-radius: 99px;
      font-size: 0.8rem; font-weight: 700;
    }
    .role-chip.werewolf { background: rgba(198,40,40,.14); color: #c62828; }
    .role-chip.seer     { background: rgba(26,82,118,.14); color: #1a5276; }
    .role-chip.knight   { background: rgba(22,99,36,.14); color: #166324; }
    .role-chip.villager { background: rgba(107,91,122,.12); color: #6b5b7a; }

    /* ===== ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ ===== */
    #screen-title {
      align-items: center; justify-content: center;
      text-align: center; gap: 22px;
    }
    .title-wolf { font-size: 5.5rem; filter: drop-shadow(0 6px 14px rgba(0,0,0,.22)); }
    .start-btn {
      width: 100%; max-width: 340px; padding: 19px;
      background: linear-gradient(135deg, var(--purple-lt), var(--purple));
      color: #fff; border: none; border-radius: 16px;
      font-size: 1.2rem; font-weight: 800; cursor: pointer;
      box-shadow: 0 6px 22px rgba(124,92,191,.42);
      transition: transform 0.1s;
    }
    .start-btn:active { transform: scale(0.97); }

    /* ===== å½¹å‰²ç¢ºèª å¾…æ©Ÿ ===== */
    #screen-role-wait {
      align-items: center; justify-content: center;
      text-align: center; gap: 18px;
    }
    .rw-icon { font-size: 3.5rem; }
    .rw-name { font-size: 2rem; font-weight: 900; color: var(--text); }
    .rw-inst { font-size: 0.9rem; color: var(--text-sub); line-height: 1.6; }
    .pdots { display: flex; gap: 9px; justify-content: center; }
    .pdot {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--border); transition: background 0.3s;
    }
    .pdot.done { background: var(--purple); }
    .pdot.cur  { background: var(--purple-lt); outline: 2px solid var(--purple); outline-offset: 1px; }

    /* ===== å½¹è·ã‚«ãƒ¼ãƒ‰ ===== */
    #screen-role-show {
      align-items: center; justify-content: center; gap: 18px;
    }
    .role-card {
      width: 100%; max-width: 340px;
      border-radius: 24px; padding: 40px 24px;
      text-align: center; color: #fff;
      box-shadow: 0 12px 40px rgba(0,0,0,.3);
    }
    .role-card.werewolf { background: linear-gradient(150deg, #2d0d0d, #8b1414); }
    .role-card.seer     { background: linear-gradient(150deg, #0d1a2d, #1a5276); }
    .role-card.knight   { background: linear-gradient(150deg, #0d2d10, #166324); }
    .role-card.villager { background: linear-gradient(150deg, #2d1f3d, var(--purple-dk)); }
    .rc-emoji  { font-size: 4.5rem; margin-bottom: 16px; display: block; }
    .rc-name   { font-size: 2rem; font-weight: 900; margin-bottom: 4px; }
    .rc-ruby   { font-size: 0.82rem; opacity: .76; margin-bottom: 18px; }
    .rc-desc   { font-size: 0.95rem; line-height: 1.7; opacity: .92; margin-bottom: 18px; }
    .rc-team   {
      display: inline-block; background: rgba(255,255,255,.18);
      padding: 8px 18px; border-radius: 99px; font-size: 0.85rem;
    }

    /* ===== å¤œç”»é¢ ===== */
    .night-inst {
      background: rgba(167,139,189,.1); border-radius: 12px;
      padding: 14px 16px; color: var(--text-sub);
      font-size: 0.9rem; line-height: 1.7; margin-bottom: 14px;
    }
    .night-inst strong { color: var(--text); }

    /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠã‚°ãƒªãƒƒãƒ‰ */
    .p-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .p-btn {
      padding: 20px 8px;
      background: rgba(167,139,189,.08); border: 2px solid var(--border);
      border-radius: 14px; font-size: 1rem; font-weight: 700;
      color: var(--text); cursor: pointer;
      transition: all 0.15s; min-height: 68px;
    }
    .p-btn:active:not(.unavail) { transform: scale(0.94); }
    .p-btn.sel {
      background: rgba(124,92,191,.22); border-color: var(--purple);
      color: var(--purple-lt);
      box-shadow: 0 0 16px rgba(124,92,191,.28);
    }
    .p-btn.unavail { opacity: 0.28; cursor: not-allowed; }

    /* å ã„çµæœ */
    .seer-result {
      border-radius: 16px; padding: 26px;
      text-align: center; margin: 14px 0;
    }
    .seer-result.safe { background: rgba(26,82,118,.12); border: 1px solid rgba(26,82,118,.26); }
    .seer-result.wolf { background: rgba(198,40,40,.12); border: 1px solid rgba(198,40,40,.26); }
    .sr-emoji  { font-size: 2.8rem; margin-bottom: 10px; display: block; }
    .sr-target { font-size: 1.3rem; font-weight: 900; margin-bottom: 6px; }
    .seer-result.safe .sr-target { color: #1a5276; }
    .seer-result.wolf .sr-target { color: #c62828; }
    .sr-verdict { font-size: 0.95rem; color: var(--text-sub); }

    /* ===== æ˜¼ç”»é¢ ===== */
    .result-box {
      border-radius: 16px; padding: 22px;
      text-align: center; margin-bottom: 14px;
    }
    .result-box.killed {
      background: rgba(198,40,40,.1); border: 1px solid rgba(198,40,40,.24);
    }
    .result-box.safe {
      background: rgba(56,142,60,.1); border: 1px solid rgba(56,142,60,.24);
    }
    .rb-emoji { font-size: 2.6rem; margin-bottom: 8px; }
    .rb-name  { font-size: 1.5rem; font-weight: 900; }
    .result-box.killed .rb-name { color: #c62828; }
    .result-box.safe   .rb-name { color: #388e3c; }
    .rb-sub { font-size: 0.88rem; color: var(--text-sub); margin-top: 4px; }

    /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ */
    .pl-item {
      display: flex; align-items: center; gap: 10px;
      padding: 11px 4px; border-bottom: 1px solid var(--border);
      font-size: 0.95rem; color: var(--text);
    }
    .pl-item:last-child { border-bottom: none; }
    .pl-item.dead { opacity: 0.4; }
    .pl-icon { font-size: 1.2rem; flex-shrink: 0; }

    /* CPUç™ºè¨€ */
    .speech-item {
      padding: 13px 15px;
      background: rgba(124,92,191,.07);
      border-radius: 14px; border-top-left-radius: 4px;
      margin-bottom: 10px;
    }
    .sp-name { font-size: 0.78rem; font-weight: 700; color: var(--purple-lt); margin-bottom: 3px; }
    .sp-text { font-size: 0.9rem; color: var(--text); line-height: 1.6; }

    /* ===== æŠ•ç¥¨ç”»é¢ ===== */
    .voter-banner {
      background: rgba(124,92,191,.1);
      border-radius: 14px; padding: 14px 16px; margin-bottom: 14px;
    }
    .vb-turn { font-size: 0.75rem; color: var(--text-sub); margin-bottom: 3px; }
    .vb-name { font-size: 1.25rem; font-weight: 900; color: var(--text); }
    .v-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .v-btn {
      padding: 20px 10px; background: var(--card);
      border: 2px solid var(--border); border-radius: 14px;
      font-size: 1rem; font-weight: 700; color: var(--text);
      cursor: pointer; min-height: 68px;
      transition: all 0.15s; white-space: pre-line;
    }
    .v-btn:active:not(.no-vote) { transform: scale(0.94); }
    .v-btn.sel {
      background: var(--purple); border-color: var(--purple); color: #fff;
      box-shadow: 0 4px 14px rgba(124,92,191,.42);
    }
    .v-btn.no-vote { opacity: 0.3; cursor: not-allowed; }

    /* ===== æŠ•ç¥¨çµæœ ===== */
    .vr-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .vr-name {
      width: 78px; flex-shrink: 0; font-size: 0.9rem;
      font-weight: 700; color: var(--text);
    }
    .vr-bar-track {
      flex: 1; height: 32px; background: var(--border);
      border-radius: 8px; overflow: hidden;
    }
    .vr-bar-fill {
      height: 100%; border-radius: 8px;
      background: linear-gradient(90deg, var(--purple-lt), var(--purple));
      display: flex; align-items: center; justify-content: flex-end;
      padding-right: 8px; color: #fff; font-size: 0.85rem; font-weight: 700;
      transition: width 0.6s cubic-bezier(.4,0,.2,1);
      min-width: 2px;
    }
    .vr-bar-fill.top { background: linear-gradient(90deg, #e57373, #c62828); }
    .ex-box {
      background: rgba(198,40,40,.1); border: 1px solid rgba(198,40,40,.26);
      border-radius: 16px; padding: 22px; text-align: center; margin: 14px 0;
    }
    .ex-name { font-size: 1.5rem; font-weight: 900; color: #c62828; margin-bottom: 8px; }
    .ex-role { font-size: 1rem; color: var(--text-sub); }

    /* ===== ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ===== */
    #screen-gameover {
      align-items: center; justify-content: center;
      text-align: center; gap: 16px;
    }
    .go-emoji { font-size: 5rem; }
    .go-title { font-size: 2rem; font-weight: 900; color: var(--text); }
    .go-roster {
      width: 100%; max-width: 360px;
      background: var(--card); border-radius: 16px;
      padding: 4px 16px; box-shadow: 0 2px 10px rgba(107,91,122,.09);
    }
    .go-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .go-item:last-child { border-bottom: none; }
    .go-item.dead { opacity: 0.45; }
    .gi-name { font-weight: 700; color: var(--text); }
    .gi-role { color: var(--text-sub); font-size: 0.85rem; }
    .again-btn {
      width: 100%; max-width: 340px; padding: 18px;
      background: linear-gradient(135deg, var(--purple-lt), var(--purple));
      color: #fff; border: none; border-radius: 16px;
      font-size: 1.1rem; font-weight: 800; cursor: pointer;
      box-shadow: 0 4px 16px rgba(124,92,191,.42);
      transition: transform 0.1s;
    }
    .again-btn:active { transform: scale(0.97); }

    /* ===== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
    .mt8  { margin-top: 8px; }
    .mt12 { margin-top: 12px; }
    .mt16 { margin-top: 16px; }
    .mt20 { margin-top: 20px; }
    .mb12 { margin-bottom: 12px; }
    .mb16 { margin-bottom: 16px; }
    .center { text-align: center; }
  </style>
</head>
<body>

<!-- ============================================================ -->
<!-- ç”»é¢1: ã‚¿ã‚¤ãƒˆãƒ«                                              -->
<!-- ============================================================ -->
<div id="screen-title" class="screen active">
  <div class="title-wolf">ğŸº</div>
  <div>
    <h1>äººç‹¼ã‚²ãƒ¼ãƒ </h1>
    <p class="sub mt8">ã¿ã‚“ãªã§æ¥½ã—ã‚€<ruby>æ¨ç†<rt>ã™ã„ã‚Š</rt></ruby>ã‚²ãƒ¼ãƒ </p>
  </div>

  <div class="card" style="max-width:340px;width:100%;">
    <span class="lbl">ã‚ãã³ã‹ãŸ</span>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.4rem;flex-shrink:0;">ğŸŒ™</span>
        <span style="font-size:0.87rem;color:var(--text);line-height:1.65;">å¤œï¼š<ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby>ãŒæ‘äººã‚’1äººå€’ã™</span>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.4rem;flex-shrink:0;">â˜€ï¸</span>
        <span style="font-size:0.87rem;color:var(--text);line-height:1.65;">æ˜¼ï¼šã¿ã‚“ãªã§è©±ã—åˆã„ã€æ€ªã—ã„äººã‚’<ruby>è¿½æ”¾<rt>ã¤ã„ã»ã†</rt></ruby>ã™ã‚‹</span>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.4rem;flex-shrink:0;">ğŸ†</span>
        <span style="font-size:0.87rem;color:var(--text);line-height:1.65;"><strong>æ‘äººãƒãƒ¼ãƒ ï¼š</strong><ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby>ã‚’å…¨å“¡<ruby>è¿½æ”¾<rt>ã¤ã„ã»ã†</rt></ruby>ã—ãŸã‚‰å‹ã¡<br><strong><ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby>ãƒãƒ¼ãƒ ï¼š</strong>æ‘äººã¨åŒæ•°ä»¥ä¸Šã«ãªã£ãŸã‚‰å‹ã¡</span>
      </div>
    </div>
  </div>

  <button class="start-btn" onclick="showSetup()">ğŸ® ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢2: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—                                          -->
<!-- ============================================================ -->
<div id="screen-setup" class="screen">
  <div class="badge">âš™ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
  <h2>ã‚²ãƒ¼ãƒ ã®è¨­å®š</h2>
  <p class="sub mb16">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äººæ•°ã¨åå‰ã‚’æ±ºã‚ã‚ˆã†</p>

  <div class="card">
    <span class="lbl">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ•°</span>
    <div class="cnt-row" id="player-count-btns"></div>
  </div>

  <div class="card">
    <span class="lbl">ä½•äººã§éŠã¶ï¼Ÿ</span>
    <div class="cnt-row" id="cpu-count-btns"></div>
    <p class="sub mt8" id="cpu-status-text"></p>
  </div>

  <div class="card">
    <span class="lbl">å½¹è·ã®å†…è¨³</span>
    <div class="role-chips" id="role-config-chips"></div>
  </div>

  <div class="card">
    <span class="lbl">ãŠãŸã™ã‘è¨­å®š</span>
    <div class="toggle-row">
      <div>
        <div style="font-weight:700;font-size:0.95rem;">ğŸ›¡ï¸ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’å®ˆã‚‹</div>
        <div class="sub mt8">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã¯å¤œã«<ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby>ã«å€’ã•ã‚Œã¾ã›ã‚“</div>
      </div>
      <button id="protect-p1-btn" class="toggle-btn" onclick="toggleProtectP1()">OFF</button>
    </div>
  </div>

  <div class="card">
    <span class="lbl">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åå‰ã¨å½¹è·</span>
    <div class="name-grid" id="player-name-inputs"></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢3: å½¹è·ç¢ºèª â€” å¾…æ©Ÿ                                      -->
<!-- ============================================================ -->
<div id="screen-role-wait" class="screen">
  <div class="rw-icon">ğŸ“±</div>
  <div>
    <div class="rw-name" id="rw-name"></div>
    <div class="rw-inst mt8">ã•ã‚“ã€æº–å‚™ã§ããŸã‚‰<br>ã€Œå½¹è·ã‚’è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
  </div>
  <div class="pdots" id="rw-dots"></div>
  <p class="sub center" style="font-size:0.8rem;">ä»–ã®äººã¯ç”»é¢ã‚’è¦‹ãªã„ã§ãã ã•ã„</p>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢4: å½¹è·ç¢ºèª â€” è¡¨ç¤º                                      -->
<!-- ============================================================ -->
<div id="screen-role-show" class="screen">
  <div id="rs-card-wrap" style="display:flex;justify-content:center;width:100%;"></div>
  <p class="sub center mt12">ã—ã£ã‹ã‚Šç¢ºèªã—ã¦ã€Œç¢ºèªã—ã¾ã—ãŸã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢5: å¤œãƒ•ã‚§ãƒ¼ã‚º                                           -->
<!-- ============================================================ -->
<div id="screen-night" class="screen">
  <div class="badge" id="night-badge">ğŸŒ™ 1æ—¥ç›®ã®å¤œ</div>
  <h2 id="night-title">å¤œã«ãªã‚Šã¾ã—ãŸ</h2>
  <div id="night-content" class="mt16"></div>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢6: æ˜¼ãƒ•ã‚§ãƒ¼ã‚º                                           -->
<!-- ============================================================ -->
<div id="screen-day" class="screen">
  <div class="badge">â˜€ï¸ æœã«ãªã‚Šã¾ã—ãŸ</div>
  <h2 class="mb16" id="day-title">æœã«ãªã‚Šã¾ã—ãŸ</h2>
  <div id="day-result-box"></div>
  <div class="card">
    <span class="lbl mb12" style="display:block;">ç”Ÿå­˜è€…ä¸€è¦§</span>
    <div id="day-player-list"></div>
  </div>
  <div id="day-speeches"></div>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢7: æŠ•ç¥¨                                                  -->
<!-- ============================================================ -->
<div id="screen-vote" class="screen">
  <div class="badge">ğŸ—³ï¸ æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º</div>
  <h2>èª°ã‚’<ruby>è¿½æ”¾<rt>ã¤ã„ã»ã†</rt></ruby>ã—ã¾ã™ã‹ï¼Ÿ</h2>
  <p class="sub mb16">æ€ªã—ã„ã¨æ€ã†äººã«æŠ•ç¥¨ã—ã‚ˆã†</p>
  <div class="voter-banner">
    <div class="vb-turn" id="vote-turn-label">æŠ•ç¥¨ã™ã‚‹äºº</div>
    <div class="vb-name" id="vote-voter-name"></div>
  </div>
  <div class="v-grid" id="vote-target-grid"></div>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢8: æŠ•ç¥¨çµæœ                                              -->
<!-- ============================================================ -->
<div id="screen-vote-result" class="screen">
  <div class="badge">ğŸ“Š æŠ•ç¥¨çµæœ</div>
  <h2 class="mb16">æŠ•ç¥¨ã®çµæœ</h2>
  <div id="vr-bars"></div>
  <div class="ex-box" id="ex-box">
    <div class="ex-name" id="ex-name"></div>
    <div class="ex-role" id="ex-role"></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- ç”»é¢9: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼                                        -->
<!-- ============================================================ -->
<div id="screen-gameover" class="screen">
  <div class="go-emoji" id="go-emoji"></div>
  <div class="go-title" id="go-title"></div>
  <div class="go-roster" id="go-roster"></div>
  <button class="again-btn" onclick="resetGame()">ğŸ”„ ã‚‚ã†ä¸€åº¦éŠã¶</button>
</div>

<!-- ============================================================ -->
<!-- å›ºå®šãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ï¼ˆå…¨ç”»é¢å…±é€šï¼‰                        -->
<!-- ============================================================ -->
<div id="nav-bar">
  <button id="nav-btn" onclick="navAction()">æ¬¡ã¸ â†’</button>
</div>

<script>
// =====================================================================
// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
// =====================================================================
const G = {
  playerCount: 5,
  cpuCount: 4,
  protectPlayer1: false,  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’å¤œã®æ”»æ’ƒã‹ã‚‰å®ˆã‚‹
  players: [],       // {id, name, role, alive, cpu, seerResults, lastProtected}
  day: 1,

  // å½¹è·ç¢ºèªãƒ•ãƒ­ãƒ¼
  revealIdx: 0,

  // å¤œãƒ•ã‚§ãƒ¼ã‚º
  nightQueue: [],    // å¤œè¡Œå‹•ãŒå¿…è¦ãªäººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é †
  nightQueueIdx: 0,
  nightKill: -1,     // äººç‹¼ã®é¸æŠã‚¿ãƒ¼ã‚²ãƒƒãƒˆID
  nightProtect: -1,  // é¨å£«ã®é¸æŠã‚¿ãƒ¼ã‚²ãƒƒãƒˆID
  nightSelTarget: -1,

  // æœãƒ•ã‚§ãƒ¼ã‚º
  killedLastNight: -1,

  // æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º
  voteQueue: [],
  voteQueueIdx: 0,
  votes: {},
  voteSelTarget: -1,

  // çµæœ
  executedId: -1,

  // ãƒŠãƒ“ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  navCb: null,
};

// =====================================================================
// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼åˆ¶å¾¡
// =====================================================================
const navBar = document.getElementById('nav-bar');
const navBtn = document.getElementById('nav-btn');

function showNav(label, cb, disabled = false, red = false) {
  navBar.style.display = 'block';
  navBtn.textContent = label;
  navBtn.disabled = disabled;
  navBtn.classList.toggle('red', red);
  G.navCb = cb;
}
function hideNav() {
  navBar.style.display = 'none';
  G.navCb = null;
}
function navAction() {
  if (G.navCb) G.navCb();
}
function setNavEnabled(ok) {
  navBtn.disabled = !ok;
}

// =====================================================================
// ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
// =====================================================================
function showScreen(id, isNight = false) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.body.classList.toggle('night', isNight);
  window.scrollTo(0, 0);
}

// =====================================================================
// ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—åˆæœŸåŒ–
// =====================================================================
const ROLE_CONFIGS = {
  4: { werewolf:1, seer:0, knight:0 },
  5: { werewolf:1, seer:1, knight:0 },
  6: { werewolf:1, seer:1, knight:1 },
  7: { werewolf:2, seer:1, knight:0 },
  8: { werewolf:2, seer:1, knight:1 },
};
const ROLE_INFO = {
  werewolf: { name:'äººç‹¼', ruby:'ã˜ã‚“ã‚ã†', emoji:'ğŸº', desc:'å¤œã«æ‘äººã‚’1äººå€’ã™', team:'äººç‹¼ãƒãƒ¼ãƒ ' },
  seer:     { name:'å ã„å¸«', ruby:'ã†ã‚‰ãªã„ã—', emoji:'ğŸ”®', desc:'å¤œã«1äººã®æ­£ä½“ã‚’å ãˆã‚‹', team:'æ‘äººãƒãƒ¼ãƒ ' },
  knight:   { name:'é¨å£«', ruby:'ãã—', emoji:'ğŸ›¡ï¸', desc:'å¤œã«1äººã‚’å®ˆã‚‹ï¼ˆé€£ç¶šåŒä¸€NGï¼‰', team:'æ‘äººãƒãƒ¼ãƒ ' },
  villager: { name:'æ‘äºº', ruby:'ã‚€ã‚‰ã³ã¨', emoji:'ğŸ‘¤', desc:'ç‰¹æ®ŠãªåŠ›ã¯ãªã„ã‘ã©æ¨ç†ã§å‹ã¦ï¼', team:'æ‘äººãƒãƒ¼ãƒ ' },
};

// =====================================================================
// ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆãŠçµµæããƒ­ã‚¸ãƒƒã‚¯ã¨å…±é€šï¼‰
// =====================================================================
const ADJECTIVES = [
  'ãã¾ã¾ãª','ã®ã‚“ã³ã‚Š','ã›ã£ã‹ã¡','ãŠã ã‚„ã‹ãª','ã²ã‚‡ã†ãã‚“ãª',
  'ã¾ã˜ã‚ãª','ã‚†ã‹ã„ãª','ãŠã£ã¨ã‚Š','ã’ã‚“ããª','ã—ãšã‹ãª',
  'ã‚ã‚ã¦ã‚“ã¼ã†ã®','ã®ã‚“ããª','ãŠã¡ã‚ƒã‚ãª','ã‚„ã•ã—ã„','ãã„ã—ã‚“ã¼ã†ã®',
  'ã­ã¼ã™ã‘','ã‚ã‚“ã±ã','ãŠã—ã‚ƒã‚Œãª','ãµã—ããª','ã™ã°ã‚„ã„'
];
const ANIMALS = [
  'ã‚«ãƒ','ã‚¤ãƒ«ã‚«','ãƒšãƒ³ã‚®ãƒ³','ã‚¢ã‚¶ãƒ©ã‚·','ãƒ©ãƒƒã‚³','ã‚¯ãƒ©ã‚²',
  'ãƒãƒ³ãƒœã‚¦','ã‚µãƒ¡','ã‚«ãƒ¡','ã‚¿ã‚³','ã‚¤ã‚«',
  'ã‚¯ãƒãƒãƒŸ','ã‚¨ã‚¤','ãƒãƒ³ã‚¢ãƒŠã‚´','ã‚«ãƒ¯ã‚¦ã‚½','ã‚ªãƒƒãƒˆã‚»ã‚¤',
  'ã‚¯ã‚¸ãƒ©','ã‚·ãƒ£ãƒ','ãƒ•ã‚°','ã‚¿ãƒ„ãƒã‚ªãƒˆã‚·ã‚´','ã‚«ãƒ‹'
];

function randomName(exclude = []) {
  let name, tries = 0;
  do {
    const adj = ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];
    const ani = ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
    name = adj + ani;
    tries++;
  } while (exclude.includes(name) && tries < 50);
  return name;
}

const _savedNames = {}; // {idx: {adj, ani, jobId}}
const _cpuNames = {};   // {idx: string}

function toggleProtectP1() {
  G.protectPlayer1 = !G.protectPlayer1;
  const btn = document.getElementById('protect-p1-btn');
  btn.textContent = G.protectPlayer1 ? 'ON' : 'OFF';
  btn.classList.toggle('on', G.protectPlayer1);
}

function showSetup() {
  hideNav();
  showScreen('screen-setup');
  renderAll();
  // ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åæ˜ 
  const btn = document.getElementById('protect-p1-btn');
  if (btn) {
    btn.textContent = G.protectPlayer1 ? 'ON' : 'OFF';
    btn.classList.toggle('on', G.protectPlayer1);
  }
  showNav('ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ â†’', startGame);
}

function renderAll() {
  renderPlayerCount();
  renderCpuCount();
  renderRoleChips();
  renderNames();
}

function renderPlayerCount() {
  const c = document.getElementById('player-count-btns');
  c.innerHTML = '';
  [4,5,6,7,8].forEach(n => {
    const b = document.createElement('button');
    b.className = 'cnt-btn' + (n === G.playerCount ? ' sel' : '');
    b.textContent = n + 'äºº';
    b.onclick = () => {
      G.playerCount = n;
      G.cpuCount = G.playerCount - 1; // å¸¸ã«1äººã§ãƒ—ãƒ¬ã‚¤ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      renderAll();
    };
    c.appendChild(b);
  });
}

function renderCpuCount() {
  const c = document.getElementById('cpu-count-btns');
  c.innerHTML = '';
  const humanCount = G.playerCount - G.cpuCount;
  for (let h = 1; h <= G.playerCount; h++) {
    const b = document.createElement('button');
    b.className = 'cnt-btn' + (h === humanCount ? ' sel' : '');
    b.textContent = h + 'äºº';
    b.onclick = () => { G.cpuCount = G.playerCount - h; renderCpuCount(); renderRoleChips(); renderNames(); };
    c.appendChild(b);
  }
  document.getElementById('cpu-status-text').textContent =
    G.cpuCount === 0
      ? 'å…¨å“¡äººé–“ã§ãƒ—ãƒ¬ã‚¤ï¼ˆé †ç•ªã«ãƒ‘ã‚¹ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰'
      : `æ®‹ã‚Š ${G.cpuCount}äººã¯CPUãŒå‚åŠ `;
}

function renderRoleChips() {
  const cfg = ROLE_CONFIGS[G.playerCount];
  const villagers = G.playerCount - cfg.werewolf - cfg.seer - cfg.knight;
  const c = document.getElementById('role-config-chips');
  c.innerHTML = '';
  const add = (role, n) => {
    if (n <= 0) return;
    const d = document.createElement('div');
    d.className = `role-chip ${role}`;
    d.textContent = `${ROLE_INFO[role].emoji} ${ROLE_INFO[role].name} Ã—${n}`;
    c.appendChild(d);
  };
  add('werewolf', cfg.werewolf);
  add('seer', cfg.seer);
  add('knight', cfg.knight);
  add('villager', villagers);
}

function renderNames() {
  const c = document.getElementById('player-name-inputs');
  // ç¾åœ¨ã®äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é¸æŠã‚’ä¿å­˜
  c.querySelectorAll('.name-wrap[data-type="human"]').forEach(wrap => {
    const idx = wrap.dataset.idx;
    const adjSel = wrap.querySelector('.adj-sel');
    const aniSel = wrap.querySelector('.ani-sel');
    const roleSel = wrap.querySelector('.role-sel');
    if (adjSel && aniSel) _savedNames[idx] = {
      adj: adjSel.value, ani: aniSel.value,
      roleId: roleSel ? roleSel.value : 'random'
    };
  });
  c.innerHTML = '';

  // æ—¢å­˜CPUãƒãƒ¼ãƒ ã®ãƒªã‚¹ãƒˆï¼ˆé‡è¤‡å›é¿ç”¨ï¼‰
  const usedCpuNames = Object.entries(_cpuNames)
    .filter(([k]) => parseInt(k) >= G.playerCount - G.cpuCount)
    .map(([, v]) => v);

  for (let i = 0; i < G.playerCount; i++) {
    const isCpu = i >= G.playerCount - G.cpuCount;
    const wrap = document.createElement('div');
    wrap.className = 'name-wrap';
    wrap.dataset.idx = i;
    wrap.dataset.type = isCpu ? 'cpu' : 'human';

    const num = document.createElement('span');
    num.className = 'name-num';
    num.textContent = i + 1;
    wrap.appendChild(num);

    if (isCpu) {
      // CPUã¯ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆåï¼ˆåˆå›ã®ã¿ç”Ÿæˆï¼‰
      if (!_cpuNames[i]) {
        _cpuNames[i] = randomName(usedCpuNames);
        usedCpuNames.push(_cpuNames[i]);
      }
      const label = document.createElement('div');
      label.className = 'name-cpu-label';
      label.textContent = 'ğŸ¤– ' + _cpuNames[i];
      wrap.appendChild(label);
    } else {
      // äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šåå‰ï¼‹è·æ¥­ã®ã‚»ãƒ¬ã‚¯ãƒˆ
      delete _cpuNames[i];
      const saved = _savedNames[i];
      const defAdj   = saved ? saved.adj   : ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];
      const defAni   = saved ? saved.ani   : ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
      const defRoleId = saved ? saved.roleId : 'random';

      const fields = document.createElement('div');
      fields.className = 'name-fields';

      // åå‰è¡Œ
      const selWrap = document.createElement('div');
      selWrap.className = 'name-selects';
      const adjSel = document.createElement('select');
      adjSel.className = 'name-select adj-sel';
      ADJECTIVES.forEach(adj => {
        const opt = document.createElement('option');
        opt.value = adj; opt.textContent = adj;
        if (adj === defAdj) opt.selected = true;
        adjSel.appendChild(opt);
      });
      const aniSel = document.createElement('select');
      aniSel.className = 'name-select ani-sel';
      ANIMALS.forEach(ani => {
        const opt = document.createElement('option');
        opt.value = ani; opt.textContent = ani;
        if (ani === defAni) opt.selected = true;
        aniSel.appendChild(opt);
      });
      selWrap.appendChild(adjSel);
      selWrap.appendChild(aniSel);
      fields.appendChild(selWrap);

      // å½¹è·é¸æŠè¡Œ
      const roleRow = document.createElement('div');
      roleRow.className = 'role-row';

      const roleSel = document.createElement('select');
      roleSel.className = 'role-sel';

      // ãŠã¾ã‹ã›ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
      const randOpt = document.createElement('option');
      randOpt.value = 'random';
      randOpt.textContent = 'ğŸ² ãŠã¾ã‹ã›ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰';
      roleSel.appendChild(randOpt);

      // å„å½¹è·ï¼ˆROLE_INFOã®é †ã§ï¼‰
      [['werewolf','äººç‹¼','ã˜ã‚“ã‚ã†','ğŸº'],['seer','å ã„å¸«','ã†ã‚‰ãªã„ã—','ğŸ”®'],['knight','é¨å£«','ãã—','ğŸ›¡ï¸'],['villager','æ‘äºº','ã‚€ã‚‰ã³ã¨','ğŸ‘¤']].forEach(([id,name,ruby,emoji]) => {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = `${emoji} ${name}ï¼ˆ${ruby}ï¼‰`;
        roleSel.appendChild(opt);
      });

      roleRow.appendChild(roleSel);
      fields.appendChild(roleRow);

      wrap.appendChild(fields);
    }

    c.appendChild(wrap);
  }
}

// =====================================================================
// ã‚²ãƒ¼ãƒ é–‹å§‹
// =====================================================================
function startGame() {
  G.players = [];
  const nameWraps = document.querySelectorAll('#player-name-inputs .name-wrap');
  for (let i = 0; i < G.playerCount; i++) {
    const isCpu = i >= G.playerCount - G.cpuCount;
    let name, presetRole;
    if (isCpu) {
      name = _cpuNames[i] || randomName();
      presetRole = '';
    } else {
      const wrap = nameWraps[i];
      const adjSel = wrap && wrap.querySelector('.adj-sel');
      const aniSel = wrap && wrap.querySelector('.ani-sel');
      const roleSel = wrap && wrap.querySelector('.role-sel');
      name = (adjSel && aniSel) ? adjSel.value + aniSel.value : `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i + 1}`;
      presetRole = (roleSel && roleSel.value !== 'random') ? roleSel.value : '';
    }
    G.players.push({
      id: i,
      name: name,
      role: presetRole,
      alive: true,
      cpu: isCpu,
      seerResults: [],
      lastProtected: -1,
    });
  }

  // å½¹è·å‰²ã‚Šå½“ã¦ï¼ˆå›ºå®šæŒ‡å®šã‚ã‚Š â†’ ãã®ã¾ã¾ã€'' â†’ ãƒ©ãƒ³ãƒ€ãƒ å‰²ã‚Šå½“ã¦ï¼‰
  const cfg = ROLE_CONFIGS[G.playerCount];

  const fixedPlayers = G.players.filter(p => p.role !== '');
  const randomPlayers = G.players.filter(p => p.role === '');

  const fixedCounts = { werewolf:0, seer:0, knight:0, villager:0 };
  fixedPlayers.forEach(p => { if (fixedCounts[p.role] !== undefined) fixedCounts[p.role]++; });

  let pool = [];
  for (let i = 0; i < Math.max(0, cfg.werewolf - fixedCounts.werewolf); i++) pool.push('werewolf');
  for (let i = 0; i < Math.max(0, cfg.seer - fixedCounts.seer); i++) pool.push('seer');
  for (let i = 0; i < Math.max(0, cfg.knight - fixedCounts.knight); i++) pool.push('knight');
  while (pool.length < randomPlayers.length) pool.push('villager');
  pool = pool.slice(0, randomPlayers.length);

  for (let i = pool.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [pool[i], pool[j]] = [pool[j], pool[i]];
  }

  randomPlayers.forEach((p, i) => { p.role = pool[i]; });

  G.day = 1;
  G.revealIdx = 0;
  beginRoleReveal();
}

// =====================================================================
// å½¹è·ç¢ºèªãƒ•ã‚§ãƒ¼ã‚º
// =====================================================================
function beginRoleReveal() {
  // CPUãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¹ã‚­ãƒƒãƒ—
  while (G.revealIdx < G.playerCount && G.players[G.revealIdx].cpu) {
    G.revealIdx++;
  }
  if (G.revealIdx >= G.playerCount) {
    beginNight();
    return;
  }
  showRoleWaitScreen();
}

function showRoleWaitScreen() {
  const p = G.players[G.revealIdx];
  document.getElementById('rw-name').textContent = p.name;

  // é€²æ—ãƒ‰ãƒƒãƒˆï¼ˆäººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã ã‘ï¼‰
  const humans = G.players.filter(x => !x.cpu);
  const currentHumanOrder = G.players.slice(0, G.revealIdx + 1).filter(x => !x.cpu).length - 1;
  const dots = document.getElementById('rw-dots');
  dots.innerHTML = '';
  humans.forEach((_, hi) => {
    const d = document.createElement('div');
    if (hi < currentHumanOrder) d.className = 'pdot done';
    else if (hi === currentHumanOrder) d.className = 'pdot cur';
    else d.className = 'pdot';
    dots.appendChild(d);
  });

  showScreen('screen-role-wait');
  showNav('ğŸ‘ï¸ å½¹è·ã‚’è¦‹ã‚‹', showRoleCard);
}

function showRoleCard() {
  const p = G.players[G.revealIdx];
  const info = ROLE_INFO[p.role];
  const allies = p.role === 'werewolf'
    ? G.players.filter(x => x.role === 'werewolf' && x.id !== p.id)
    : [];
  const teamText = allies.length > 0
    ? `ğŸº ä»²é–“: ${allies.map(a => a.name).join(', ')}`
    : `ãƒãƒ¼ãƒ : ${info.team}`;

  document.getElementById('rs-card-wrap').innerHTML = `
    <div class="role-card ${p.role}">
      <span class="rc-emoji">${info.emoji}</span>
      <div class="rc-name">${info.name}</div>
      <div class="rc-ruby">${info.ruby}</div>
      <div class="rc-desc">${info.desc}</div>
      <div class="rc-team">${teamText}</div>
    </div>
  `;
  showScreen('screen-role-show');
  showNav('âœ“ ç¢ºèªã—ã¾ã—ãŸ', () => {
    G.revealIdx++;
    beginRoleReveal();
  });
}

// =====================================================================
// å¤œãƒ•ã‚§ãƒ¼ã‚º
// =====================================================================
function beginNight() {
  G.nightKill = -1;
  G.nightProtect = -1;
  G.nightSelTarget = -1;

  // ç”Ÿå­˜ä¸­ã®å…¨äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å¤œã®è¡Œå‹•ã‚­ãƒ¥ãƒ¼ã«ï¼ˆæ‘äººã‚‚å«ã‚€ï¼‰
  G.nightQueue = G.players.filter(p => !p.cpu && p.alive);
  G.nightQueueIdx = 0;
  processNightQueue();
}

function processNightQueue() {
  if (G.nightQueueIdx >= G.nightQueue.length) {
    // å…¨äººé–“ã®è¡Œå‹•å®Œäº† â†’ CPUè¡Œå‹• â†’ çµæœé©ç”¨
    doCpuNightActions();
    applyNightKill();
    showDayPhase();
    return;
  }
  showNightAction();
}

function showNightAction() {
  const p = G.nightQueue[G.nightQueueIdx];
  G.nightSelTarget = -1;

  document.getElementById('night-badge').textContent = `ğŸŒ™ ${G.day}æ—¥ç›®ã®å¤œ`;
  document.getElementById('night-title').textContent = `${p.name}ã•ã‚“ã®ç•ª`;

  const content = document.getElementById('night-content');

  if (p.role === 'werewolf') {
    // äººç‹¼ï¼šèª°ã‚’å€’ã™ã‹é¸ã¶ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ä¿è­·ONãªã‚‰é™¤å¤–ï¼‰
    const targets = G.players.filter(x =>
      x.alive && x.role !== 'werewolf' &&
      !(G.protectPlayer1 && x.id === 0)
    );
    const shieldNote = G.protectPlayer1
      ? '<br><small style="opacity:.7;">ï¼ˆğŸ›¡ï¸ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã¯é¸ã¹ã¾ã›ã‚“ï¼‰</small>' : '';
    content.innerHTML = `
      <div class="night-inst">ğŸº ã‚ãªãŸã¯<strong><ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby></strong>ã§ã™ã€‚<br>ä»Šå¤œã€èª°ã‚’å€’ã—ã¾ã™ã‹ï¼Ÿ${shieldNote}</div>
      <div class="p-grid" id="night-grid"></div>
    `;
    if (targets.length === 0) {
      content.innerHTML = `<div class="night-inst">ğŸº ã‚ãªãŸã¯<strong><ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby></strong>ã§ã™ã€‚<br>ä»Šå¤œã¯<ruby>å€’<rt>ãŸãŠ</rt></ruby>ã›ã‚‹<ruby>ç›¸æ‰‹<rt>ã‚ã„ã¦</rt></ruby>ãŒã„ã¾ã›ã‚“ã€‚</div>`;
      showScreen('screen-night', true);
      showNav('æ¬¡ã¸ â†’', () => { G.nightQueueIdx++; processNightQueue(); });
      return;
    }
    const grid = document.getElementById('night-grid');
    targets.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'p-btn';
      btn.textContent = t.name;
      btn.onclick = () => {
        G.nightSelTarget = t.id;
        grid.querySelectorAll('.p-btn').forEach(b => b.classList.remove('sel'));
        btn.classList.add('sel');
        setNavEnabled(true);
      };
      grid.appendChild(btn);
    });
    showScreen('screen-night', true);
    showNav('âš”ï¸ æ±ºå®šã™ã‚‹', confirmWerewolfAction, true);

  } else if (p.role === 'seer') {
    // å ã„å¸«ï¼šèª°ã®æ­£ä½“ã‚’å ã†ã‹é¸ã¶
    const targets = G.players.filter(x => x.alive && x.id !== p.id);
    content.innerHTML = `
      <div class="night-inst">ğŸ”® ã‚ãªãŸã¯<strong>å ã„å¸«</strong>ã§ã™ã€‚<br>èª°ã®æ­£ä½“ã‚’å ã„ã¾ã™ã‹ï¼Ÿ</div>
      <div class="p-grid" id="night-grid"></div>
    `;
    const grid = document.getElementById('night-grid');
    targets.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'p-btn';
      btn.textContent = t.name;
      btn.onclick = () => {
        G.nightSelTarget = t.id;
        grid.querySelectorAll('.p-btn').forEach(b => b.classList.remove('sel'));
        btn.classList.add('sel');
        setNavEnabled(true);
      };
      grid.appendChild(btn);
    });
    showScreen('screen-night', true);
    showNav('ğŸ”® å ã†', confirmSeerAction, true);

  } else if (p.role === 'knight') {
    // é¨å£«ï¼šèª°ã‚’å®ˆã‚‹ã‹é¸ã¶ï¼ˆå‰å›ã¨åŒã˜äººã¯NGï¼‰
    let targets = G.players.filter(x => x.alive && x.id !== p.id && x.id !== p.lastProtected);
    if (targets.length === 0) {
      // é€£ç¶šNGã§å…¨å“¡é™¤å¤–ã•ã‚ŒãŸå ´åˆã¯NGåˆ¶ç´„ã‚’è§£é™¤ã—ã¦å…¨å“¡ã‚’å¯¾è±¡ã«ã™ã‚‹
      targets = G.players.filter(x => x.alive && x.id !== p.id);
    }
    const lastNote = p.lastProtected >= 0
      ? `<br><small style="opacity:.7;">ï¼ˆå‰å›å®ˆã£ãŸ ${G.players[p.lastProtected]?.name} ã•ã‚“ã¯é¸ã¹ã¾ã›ã‚“ï¼‰</small>` : '';
    content.innerHTML = `
      <div class="night-inst">ğŸ›¡ï¸ ã‚ãªãŸã¯<strong>é¨å£«</strong>ã§ã™ã€‚<br>èª°ã‚’å®ˆã‚Šã¾ã™ã‹ï¼Ÿ${lastNote}</div>
      <div class="p-grid" id="night-grid"></div>
    `;
    const grid = document.getElementById('night-grid');
    targets.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'p-btn';
      btn.textContent = t.name;
      btn.onclick = () => {
        G.nightSelTarget = t.id;
        grid.querySelectorAll('.p-btn').forEach(b => b.classList.remove('sel'));
        btn.classList.add('sel');
        setNavEnabled(true);
      };
      grid.appendChild(btn);
    });
    showScreen('screen-night', true);
    showNav('ğŸ›¡ï¸ å®ˆã‚‹', confirmKnightAction, true);

  } else {
    // æ‘äººï¼šè¡Œå‹•ãªã—ã€æ¬¡ã¸
    content.innerHTML = `
      <div class="night-inst">ğŸ‘¤ ã‚ãªãŸã¯<strong>æ‘äºº</strong>ã§ã™ã€‚<br>å¤œã¯ä½•ã‚‚ã§ãã¾ã›ã‚“ã€‚<br>ã€Œæ¬¡ã¸ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>
    `;
    showScreen('screen-night', true);
    showNav('æ¬¡ã¸ â†’', () => { G.nightQueueIdx++; processNightQueue(); });
  }
}

function confirmWerewolfAction() {
  G.nightKill = G.nightSelTarget;
  G.nightQueueIdx++;
  processNightQueue();
}

function confirmSeerAction() {
  const p = G.nightQueue[G.nightQueueIdx];
  const target = G.players[G.nightSelTarget];
  const isWolf = target.role === 'werewolf';
  p.seerResults.push({ targetId: target.id, isWerewolf: isWolf });

  // å ã„çµæœã‚’è¡¨ç¤º
  const cls = isWolf ? 'wolf' : 'safe';
  const emoji = isWolf ? 'ğŸº' : 'âœ…';
  const verdict = isWolf
    ? `${target.name}ã•ã‚“ã¯ ğŸº <ruby>äººç‹¼<rt>ã˜ã‚“ã‚ã†</rt></ruby> ã§ã™ï¼`
    : `${target.name}ã•ã‚“ã¯æ‘äººãƒãƒ¼ãƒ ã§ã—ãŸ`;
  document.getElementById('night-content').innerHTML = `
    <div class="night-inst">ğŸ”® å ã„ã®çµæœãŒå‡ºã¾ã—ãŸâ€¦</div>
    <div class="seer-result ${cls}">
      <span class="sr-emoji">${emoji}</span>
      <div class="sr-target">${target.name}</div>
      <div class="sr-verdict">${verdict}</div>
    </div>
  `;
  showNav('âœ“ ã‚ã‹ã‚Šã¾ã—ãŸ', () => {
    G.nightQueueIdx++;
    processNightQueue();
  });
}

function confirmKnightAction() {
  const p = G.nightQueue[G.nightQueueIdx];
  G.nightProtect = G.nightSelTarget;
  p.lastProtected = G.nightSelTarget;
  G.nightQueueIdx++;
  processNightQueue();
}

function doCpuNightActions() {
  // CPUäººç‹¼ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ä¿è­·ONãªã‚‰é™¤å¤–ï¼‰
  const wolfCpu = G.players.find(p => p.cpu && p.alive && p.role === 'werewolf');
  if (wolfCpu && G.nightKill === -1) {
    const targets = G.players.filter(p =>
      p.alive && p.role !== 'werewolf' &&
      !(G.protectPlayer1 && p.id === 0)
    );
    if (targets.length > 0) G.nightKill = targets[Math.floor(Math.random() * targets.length)].id;
  }
  // CPUå ã„å¸«
  const seerCpu = G.players.find(p => p.cpu && p.alive && p.role === 'seer');
  if (seerCpu) {
    const checked = seerCpu.seerResults.map(r => r.targetId);
    const cands = G.players.filter(p => p.alive && p.id !== seerCpu.id && !checked.includes(p.id));
    if (cands.length > 0) {
      const t = cands[Math.floor(Math.random() * cands.length)];
      seerCpu.seerResults.push({ targetId: t.id, isWerewolf: t.role === 'werewolf' });
    }
  }
  // CPUé¨å£«
  const knightCpu = G.players.find(p => p.cpu && p.alive && p.role === 'knight');
  if (knightCpu && G.nightProtect === -1) {
    const cands = G.players.filter(p => p.alive && p.id !== knightCpu.id && p.id !== knightCpu.lastProtected);
    if (cands.length > 0) {
      const t = cands[Math.floor(Math.random() * cands.length)];
      G.nightProtect = t.id;
      knightCpu.lastProtected = t.id;
    }
  }
}

function applyNightKill() {
  const isShielded = G.protectPlayer1 && G.nightKill === 0;
  if (G.nightKill !== -1 && G.nightKill !== G.nightProtect && !isShielded) {
    G.players[G.nightKill].alive = false;
    G.killedLastNight = G.nightKill;
  } else {
    G.killedLastNight = -1;
  }
  G.nightKill = -1;
  G.nightProtect = -1;
}

// =====================================================================
// æ˜¼ãƒ•ã‚§ãƒ¼ã‚º
// =====================================================================
function showDayPhase() {
  // æœã®ç™ºè¡¨
  const rb = document.getElementById('day-result-box');
  if (G.killedLastNight !== -1) {
    const v = G.players[G.killedLastNight];
    rb.innerHTML = `
      <div class="result-box killed">
        <div class="rb-emoji">ğŸ˜¢</div>
        <div class="rb-name">${v.name}</div>
        <div class="rb-sub">ãŒæ˜¨å¤œã€å€’ã•ã‚Œã¾ã—ãŸâ€¦</div>
      </div>
    `;
  } else {
    rb.innerHTML = `
      <div class="result-box safe">
        <div class="rb-emoji">ğŸ›¡ï¸</div>
        <div class="rb-name">ä»Šå¤œã¯èª°ã‚‚å€’ã•ã‚Œãªã‹ã£ãŸï¼</div>
        <div class="rb-sub">é¨å£«ãŒå®ˆã£ãŸã®ã‹ã‚‚ã—ã‚Œãªã„â€¦</div>
      </div>
    `;
  }

  // ç”Ÿå­˜è€…ãƒªã‚¹ãƒˆ
  const pl = document.getElementById('day-player-list');
  pl.innerHTML = '';
  G.players.forEach(p => {
    const div = document.createElement('div');
    div.className = 'pl-item' + (p.alive ? '' : ' dead');
    const jobTag = '';
    const shieldTag = (G.protectPlayer1 && p.id === 0 && p.alive)
      ? `<span style="font-size:0.78rem;margin-left:4px;" title="å¤œã«å€’ã•ã‚Œã¾ã›ã‚“">ğŸ›¡ï¸</span>` : '';
    div.innerHTML = `<span class="pl-icon">${p.alive ? 'ğŸ‘¤' : 'ğŸ’€'}</span><span>${p.name}${jobTag}${shieldTag}</span>`;
    pl.appendChild(div);
  });

  // CPUç™ºè¨€
  const sd = document.getElementById('day-speeches');
  const cpus = G.players.filter(p => p.cpu && p.alive);
  if (cpus.length > 0) {
    sd.innerHTML = '<span class="lbl" style="display:block;margin-bottom:8px;">CPUã®ç™ºè¨€</span>';
    cpus.forEach(cpu => {
      const item = document.createElement('div');
      item.className = 'speech-item';
      item.innerHTML = `<div class="sp-name">${cpu.name}</div><div class="sp-text">${getCpuSpeech(cpu)}</div>`;
      sd.appendChild(item);
    });
  } else {
    sd.innerHTML = '';
  }

  showScreen('screen-day');

  // å¤œã®çµæœå¾Œã«å‹åˆ©åˆ¤å®šï¼ˆäººç‹¼ãŒæ‘äººã¨åŒæ•°ä»¥ä¸Šã«ãªã£ãŸã‚‰å³çµ‚äº†ï¼‰
  const earlyWinner = checkWin();
  if (earlyWinner) {
    showNav('ğŸ çµæœã‚’è¦‹ã‚‹ â†’', () => showGameOver(earlyWinner));
  } else {
    showNav('ğŸ—³ï¸ æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºã¸ â†’', startVote);
  }
}

function getCpuSpeech(cpu) {
  if (cpu.role === 'werewolf') {
    const targets = G.players.filter(p => p.alive && p.role !== 'werewolf');
    if (!targets.length) return 'ã‚‚ã†æ‘ã¯çµ‚ã‚ã‚Šã â€¦';
    const t = targets[Math.floor(Math.random() * targets.length)];
    return [
      `${t.name}ã•ã‚“ãŒã™ã”ãæ€ªã—ã„ã¨æ€ã„ã¾ã™`,
      `ç§ã¯æ‘äººã§ã™ã€‚${t.name}ã•ã‚“ã‚’è¿½æ”¾ã—ã¾ã—ã‚‡ã†ï¼`,
      `${t.name}ã•ã‚“ã€æ˜¨å¤œã©ã“ã«ã„ã¾ã—ãŸã‹ï¼Ÿ`,
    ][Math.floor(Math.random() * 3)];
  }
  if (cpu.role === 'seer') {
    const last = cpu.seerResults[cpu.seerResults.length - 1];
    if (last) {
      const tn = G.players[last.targetId]?.name || 'ï¼Ÿ';
      return last.isWerewolf
        ? `${tn}ã•ã‚“ã‚’å ã£ãŸã‚‰ğŸºäººç‹¼ã§ã—ãŸï¼ä¿¡ã˜ã¦ãã ã•ã„ï¼`
        : `${tn}ã•ã‚“ã‚’å ã„ã¾ã—ãŸã€‚æ‘äººãƒãƒ¼ãƒ ã§ã™`;
    }
  }
  const alive = G.players.filter(p => p.alive && p.id !== cpu.id);
  if (!alive.length) return 'ã¿ã‚“ãªã§é ‘å¼µã‚ã†ï¼';
  const t = alive[Math.floor(Math.random() * alive.length)];
  return [
    `${t.name}ã•ã‚“ã®å‹•ããŒæ°—ã«ãªã‚Šã¾ã™`,
    `äººç‹¼ã¯çµ¶å¯¾ã«ã„ã‚‹ï¼ã‚ˆãè€ƒãˆã‚ˆã†`,
    `${t.name}ã•ã‚“ã€ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿ`,
  ][Math.floor(Math.random() * 3)];
}

// =====================================================================
// æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º
// =====================================================================
function startVote() {
  G.votes = {};
  G.voteSelTarget = -1;
  G.voteQueue = G.players.filter(p => !p.cpu && p.alive);
  G.voteQueueIdx = 0;
  showVoteScreen();
}

function showVoteScreen() {
  if (G.voteQueueIdx >= G.voteQueue.length) {
    doCpuVote();
    showVoteResult();
    return;
  }

  const voter = G.voteQueue[G.voteQueueIdx];
  G.voteSelTarget = -1;

  document.getElementById('vote-turn-label').textContent =
    `æŠ•ç¥¨ã™ã‚‹äºº (${G.voteQueueIdx + 1}ï¼${G.voteQueue.length})`;
  document.getElementById('vote-voter-name').textContent = voter.name + ' ã•ã‚“';

  const grid = document.getElementById('vote-target-grid');
  grid.innerHTML = '';
  G.players.filter(p => p.alive).forEach(t => {
    const isSelf = t.id === voter.id;
    const btn = document.createElement('button');
    btn.className = 'v-btn' + (isSelf ? ' no-vote' : '');
    btn.textContent = t.name + (isSelf ? '\nï¼ˆè‡ªåˆ†ï¼‰' : '');
    if (!isSelf) {
      btn.onclick = () => {
        G.voteSelTarget = t.id;
        grid.querySelectorAll('.v-btn').forEach(b => b.classList.remove('sel'));
        btn.classList.add('sel');
        setNavEnabled(true);
      };
    }
    grid.appendChild(btn);
  });

  showScreen('screen-vote');
  showNav('âœ“ æŠ•ç¥¨ã™ã‚‹', confirmVote, true);
}

function confirmVote() {
  const voter = G.voteQueue[G.voteQueueIdx];
  G.votes[voter.id] = G.voteSelTarget;
  G.voteQueueIdx++;
  showVoteScreen();
}

function doCpuVote() {
  G.players.filter(p => p.cpu && p.alive).forEach(cpu => {
    const targets = cpu.role === 'werewolf'
      ? G.players.filter(p => p.alive && p.role !== 'werewolf')
      : G.players.filter(p => p.alive && p.id !== cpu.id);
    if (targets.length > 0) {
      G.votes[cpu.id] = targets[Math.floor(Math.random() * targets.length)].id;
    }
  });
}

function showVoteResult() {
  // é›†è¨ˆ
  const tally = {};
  Object.values(G.votes).forEach(tid => {
    tally[tid] = (tally[tid] || 0) + 1;
  });
  if (Object.keys(tally).length === 0) {
    document.getElementById('ex-name').textContent = 'è¿½æ”¾ãªã—';
    document.getElementById('ex-role').textContent = '';
    showScreen('screen-vote-result');
    const winner = checkWin();
    if (winner) showNav('ğŸ çµæœã‚’è¦‹ã‚‹ â†’', () => showGameOver(winner));
    else showNav(`ğŸŒ™ ${G.day + 1}æ—¥ç›®ã®å¤œã¸ â†’`, () => { G.day++; beginNight(); });
    return;
  }
  const totalVotes = Object.values(tally).reduce((a, b) => a + b, 0);
  const maxVotes = Math.max(...Object.values(tally));

  // ãƒãƒ¼æç”»ï¼ˆç¥¨æ•°é™é †ï¼‰
  const barsDiv = document.getElementById('vr-bars');
  barsDiv.innerHTML = '';
  const sorted = Object.entries(tally).sort((a, b) => b[1] - a[1]);
  sorted.forEach(([tid, cnt]) => {
    const p = G.players[parseInt(tid)];
    const pct = totalVotes > 0 ? Math.round((cnt / totalVotes) * 100) : 0;
    const isTop = cnt === maxVotes;
    const item = document.createElement('div');
    item.className = 'vr-item';
    item.innerHTML = `
      <div class="vr-name">${p.name}</div>
      <div class="vr-bar-track">
        <div class="vr-bar-fill${isTop ? ' top' : ''}" style="width:0%" data-pct="${pct}">&nbsp;${cnt}ç¥¨</div>
      </div>
    `;
    barsDiv.appendChild(item);
  });

  // ãƒãƒ¼ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  setTimeout(() => {
    document.querySelectorAll('.vr-bar-fill').forEach(fill => {
      fill.style.width = fill.dataset.pct + '%';
    });
  }, 80);

  // æœ€å¤šç¥¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸å‡ºï¼ˆåŒç‚¹ãªã‚‰ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
  const topIds = sorted
    .filter(([, cnt]) => cnt === maxVotes)
    .map(([tid]) => parseInt(tid));
  G.executedId = topIds[Math.floor(Math.random() * topIds.length)];
  G.players[G.executedId].alive = false;

  const ex = G.players[G.executedId];
  const info = ROLE_INFO[ex.role];
  document.getElementById('ex-name').textContent = `${ex.name} ã•ã‚“ãŒè¿½æ”¾ã•ã‚Œã¾ã—ãŸï¼`;
  document.getElementById('ex-role').textContent = `æ­£ä½“ã¯â€¦ ${info.emoji} ${info.name} ã§ã—ãŸï¼`;

  showScreen('screen-vote-result');

  const winner = checkWin();
  if (winner) {
    showNav('ğŸ çµæœã‚’è¦‹ã‚‹ â†’', () => showGameOver(winner));
  } else {
    showNav(`ğŸŒ™ ${G.day + 1}æ—¥ç›®ã®å¤œã¸ â†’`, () => { G.day++; beginNight(); });
  }
}

// =====================================================================
// å‹åˆ©åˆ¤å®š
// =====================================================================
function checkWin() {
  const wolves   = G.players.filter(p => p.alive && p.role === 'werewolf');
  const villagers = G.players.filter(p => p.alive && p.role !== 'werewolf');
  if (wolves.length === 0) return 'villager';
  if (wolves.length >= villagers.length) return 'werewolf';
  return null;
}

// =====================================================================
// ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
// =====================================================================
function showGameOver(winner) {
  const isVillager = winner === 'villager';
  document.getElementById('go-emoji').textContent = isVillager ? 'ğŸ‰' : 'ğŸº';
  document.getElementById('go-title').textContent = isVillager
    ? 'æ‘äººãƒãƒ¼ãƒ ã®å‹åˆ©ï¼' : 'äººç‹¼ãƒãƒ¼ãƒ ã®å‹åˆ©ï¼';

  const roster = document.getElementById('go-roster');
  roster.innerHTML = '';
  G.players.forEach(p => {
    const info = ROLE_INFO[p.role];
    const div = document.createElement('div');
    div.className = 'go-item' + (p.alive ? '' : ' dead');
    div.innerHTML = `
      <span class="gi-name">${p.alive ? 'ğŸ‘¤' : 'ğŸ’€'} ${p.name}</span>
      <span class="gi-role">${info.emoji} ${info.name}</span>
    `;
    roster.appendChild(div);
  });

  showScreen('screen-gameover');
  hideNav();
}

// =====================================================================
// ãƒªã‚»ãƒƒãƒˆ
// =====================================================================
function resetGame() {
  G.playerCount = 5;
  G.cpuCount = 4;
  G.players = [];
  G.day = 1;
  G.protectPlayer1 = false;
  Object.keys(_savedNames).forEach(k => delete _savedNames[k]);
  Object.keys(_cpuNames).forEach(k => delete _cpuNames[k]);
  showScreen('screen-title');
  hideNav();
}

// =====================================================================
// åˆæœŸåŒ–
// =====================================================================
document.addEventListener('DOMContentLoaded', () => {
  // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ã¯æœ€åˆéè¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‹ã‚‰é–‹å§‹ï¼‰
  hideNav();
});
</script>
</body>
</html>
