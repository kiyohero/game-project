<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>„Çπ„É©„Ç§„Éâ„Éë„Ç∫„É´</title>
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="ranking.css">
  <script src="common.js" defer></script>
  <script src="firebase-config.js"></script>
  <script src="ranking.js" defer></script>
  <style>
    h1 { font-size: 2rem; margin-bottom: 8px; }

    /* ÂãïÁâ©ÈÅ∏Êäû */
    .animal-select {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .animal-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 3px solid #d4c8e0;
      background: #fff;
      font-size: 1.4rem;
      cursor: pointer;
      transition: transform 0.15s, border-color 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .animal-btn:hover { transform: scale(1.1); }
    .animal-btn.active {
      border-color: #7a6b8a;
      background: #e8e0f0;
      transform: scale(1.15);
    }

    /* Èõ£ÊòìÂ∫¶ÈÅ∏Êäû */
    .difficulty-select {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .diff-btn {
      background: #d4c8e0;
      color: #6b5b7a;
      border: none;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.15s, transform 0.15s;
    }
    .diff-btn:hover { background: #c4b4d4; }
    .diff-btn.active {
      background: #7a6b8a;
      color: #fff;
    }

    /* „Éë„Ç∫„É´„Éú„Éº„Éâ */
    .board-wrapper {
      position: relative;
      margin-bottom: 10px;
    }
    .board {
      display: grid;
      gap: 3px;
      padding: 3px;
      background: #c4b4d4;
      border-radius: 10px;
      transition: gap 0.5s, padding 0.5s;
      touch-action: none;
    }
    .board.completed {
      gap: 0px;
      padding: 0px;
      border-radius: 10px;
      overflow: hidden;
    }

    .tile {
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: rgba(255,255,255,0.8);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      background-size: cover;
      transition: transform 0.15s ease-out, opacity 0.3s;
      position: relative;
    }
    .tile:active { transform: scale(0.95); }
    .tile.dragging {
      transition: none !important;
      z-index: 5;
    }
    .board.completed .tile {
      border-radius: 0;
      cursor: default;
    }
    .tile.empty {
      background: transparent !important;
      cursor: default;
    }
    .tile .hint-num {
      position: absolute;
      top: 2px;
      left: 4px;
      font-size: 0.65rem;
      background: rgba(0,0,0,0.35);
      color: #fff;
      border-radius: 3px;
      padding: 0 3px;
      line-height: 1.4;
      display: none;
    }
    .hint-on .tile .hint-num {
      display: block;
    }
    .tile.empty .hint-num { display: none !important; }

    /* „Éó„É¨„Éì„É•„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ */
    .preview-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border-radius: 10px;
      overflow: hidden;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
      z-index: 10;
    }
    .preview-overlay.show {
      opacity: 1;
    }
    .preview-overlay canvas {
      width: 100%;
      height: 100%;
    }

    /* „Çπ„Ç≥„Ç¢Ë°®Á§∫ */
    .score-bar {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
      font-size: 1rem;
      color: #6b5b7a;
      font-weight: bold;
    }

    /* Êìç‰Ωú„Éú„Çø„É≥ */
    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .ctrl-btn {
      background: #7a6b8a;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s, background 0.15s;
    }
    .ctrl-btn:hover { background: #6b5b7a; }
    .ctrl-btn:active { transform: scale(0.95); }
    .ctrl-btn.toggle-on {
      background: #e8a040;
    }

    /* „É©„É≥„Ç≠„É≥„Ç∞„Éú„Çø„É≥ */
    .ranking-btn {
      position: fixed;
      bottom: 18px;
      right: 18px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #7a6b8a;
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: transform 0.15s;
      z-index: 50;
    }
    .ranking-btn:hover { transform: scale(1.1); }

    /* „ÇØ„É™„Ç¢ÊºîÂá∫ */
    .clear-msg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(250, 245, 255, 0.92);
      z-index: 80;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }
    .clear-msg.show {
      opacity: 1;
      pointer-events: auto;
    }
    .clear-msg h2 {
      font-size: 2.2rem;
      color: #6b5b7a;
      margin-bottom: 10px;
      animation: bounceIn 0.6s ease;
    }
    .clear-msg .stats {
      font-size: 1.1rem;
      color: #9b8ab8;
      margin-bottom: 20px;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.1); }
      70% { transform: scale(0.95); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Á¥ôÂêπÈõ™ */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      z-index: 90;
      pointer-events: none;
      border-radius: 2px;
    }
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>üß© „Çπ„É©„Ç§„Éâ„Éë„Ç∫„É´</h1>

  <div class="animal-select" id="animalSelect"></div>
  <div class="difficulty-select" id="diffSelect"></div>

  <div class="board-wrapper">
    <div class="board" id="board"></div>
    <div class="preview-overlay" id="previewOverlay">
      <canvas id="previewCanvas"></canvas>
    </div>
  </div>

  <div class="score-bar">
    <span id="moveCount">ÊâãÊï∞: 0</span>
    <span id="timer">‚è± 00:00</span>
  </div>

  <div class="controls">
    <button class="ctrl-btn" id="shuffleBtn">üîÄ „Ç∑„É£„ÉÉ„Éï„É´</button>
    <button class="ctrl-btn" id="hintBtn">üî¢ „Éí„É≥„Éà</button>
    <button class="ctrl-btn" id="previewBtn">üëÄ „ÅäÊâãÊú¨</button>
  </div>

  <details class="how-to-play">
    <summary>„ÅÇ„Åù„Å≥„Åã„Åü</summary>
    <ul>
      <li>„Çø„Ç§„É´„Çí„Çø„ÉÉ„Éó„ÄÅ„Åæ„Åü„ÅØ„Çπ„ÉØ„Ç§„Éó„Åó„Å¶Á©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„Çπ„Å´„Çπ„É©„Ç§„Éâ„Åó„Çà„ÅÜ</li>
      <li>ÂÖ®ÈÉ®„ÅÆ„Çø„Ç§„É´„ÇíÊ≠£„Åó„ÅÑÂ†¥ÊâÄ„Å´‰∏¶„Åπ„Çã„Å®„ÄÅ„Åã„Çè„ÅÑ„ÅÑÂãïÁâ©„ÅÆÁµµ„ÅåÂÆåÊàê„Åô„Çã„ÇàÔºÅ</li>
      <li>„Äå„Éí„É≥„Éà„Äç„Éú„Çø„É≥„ÅßÁï™Âè∑„ÅåË°®Á§∫„Åï„Çå„Çã„Çà</li>
      <li>„Äå„ÅäÊâãÊú¨„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„ÅÑ„ÇãÈñì„ÄÅÂÆåÊàê„Åó„ÅüÁµµ„ÅåË¶ã„Çâ„Çå„Çã„Çà</li>
      <li>„Åß„Åç„Çã„Å†„ÅëÂ∞ë„Å™„ÅÑÊâãÊï∞„Åß„ÇØ„É™„Ç¢„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ</li>
    </ul>
  </details>

  <div class="clear-msg" id="clearMsg">
    <h2>üéâ „Åã„Çì„Åõ„ÅÑÔºÅ</h2>
    <div class="stats" id="clearStats"></div>
    <button class="btn" id="clearPlayAgain">„ÇÇ„ÅÜ„ÅÑ„Å°„Å©ÈÅä„Å∂</button>
  </div>

  <button class="ranking-btn" id="rankingBtn">üèÜ</button>

  <script>
  (function() {
    // ===== ÂãïÁâ©„Ç§„É©„Çπ„ÉàÂÆöÁæ© =====
    const ANIMALS = [
      { id: 'cat',     emoji: 'üê±', name: '„Éç„Ç≥',     draw: drawCat },
      { id: 'dog',     emoji: 'üê∂', name: '„Ç§„Éå',     draw: drawDog },
      { id: 'rabbit',  emoji: 'üê∞', name: '„Ç¶„Çµ„ÇÆ',   draw: drawRabbit },
      { id: 'panda',   emoji: 'üêº', name: '„Éë„É≥„ÉÄ',   draw: drawPanda },
      { id: 'frog',    emoji: 'üê∏', name: '„Ç´„Ç®„É´',   draw: drawFrog },
      { id: 'penguin', emoji: 'üêß', name: '„Éö„É≥„ÇÆ„É≥', draw: drawPenguin },
    ];

    const DIFFICULTIES = [
      { size: 3, label: '„Åã„Çì„Åü„Çì' },
      { size: 4, label: '„Åµ„Å§„ÅÜ' },
      { size: 5, label: '„ÇÄ„Åö„Åã„Åó„ÅÑ' },
    ];

    // ===== Áä∂ÊÖã =====
    let currentAnimal = 0;
    let currentDifficulty = 0;
    let gridSize = 3;
    let tiles = [];        // 1DÈÖçÂàó: „Çø„Ç§„É´Áï™Âè∑(0=Á©∫„Åç)
    let moves = 0;
    let timerInterval = null;
    let seconds = 0;
    let isPlaying = false;
    let hintOn = false;
    let imageDataURL = '';
    let dragState = null;
    let dragDidMove = false;
    const SWIPE_THRESHOLD = 20;

    // ===== DOM =====
    const boardEl = document.getElementById('board');
    const moveCountEl = document.getElementById('moveCount');
    const timerEl = document.getElementById('timer');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const hintBtn = document.getElementById('hintBtn');
    const previewBtn = document.getElementById('previewBtn');
    const previewOverlay = document.getElementById('previewOverlay');
    const previewCanvas = document.getElementById('previewCanvas');
    const clearMsg = document.getElementById('clearMsg');
    const clearStats = document.getElementById('clearStats');
    const clearPlayAgain = document.getElementById('clearPlayAgain');
    const rankingBtn = document.getElementById('rankingBtn');

    // ===== ÂàùÊúüÂåñ =====
    function init() {
      buildAnimalButtons();
      buildDiffButtons();
      setupEvents();
      newGame();
    }

    function buildAnimalButtons() {
      const container = document.getElementById('animalSelect');
      ANIMALS.forEach((a, i) => {
        const btn = document.createElement('button');
        btn.className = 'animal-btn' + (i === 0 ? ' active' : '');
        btn.textContent = a.emoji;
        btn.title = a.name;
        btn.addEventListener('click', () => {
          currentAnimal = i;
          container.querySelectorAll('.animal-btn').forEach((b, j) => {
            b.classList.toggle('active', j === i);
          });
          newGame();
        });
        container.appendChild(btn);
      });
    }

    function buildDiffButtons() {
      const container = document.getElementById('diffSelect');
      DIFFICULTIES.forEach((d, i) => {
        const btn = document.createElement('button');
        btn.className = 'diff-btn' + (i === 0 ? ' active' : '');
        btn.textContent = d.label;
        btn.addEventListener('click', () => {
          currentDifficulty = i;
          gridSize = d.size;
          container.querySelectorAll('.diff-btn').forEach((b, j) => {
            b.classList.toggle('active', j === i);
          });
          newGame();
        });
        container.appendChild(btn);
      });
    }

    function setupEvents() {
      shuffleBtn.addEventListener('click', () => newGame());
      hintBtn.addEventListener('click', () => {
        hintOn = !hintOn;
        hintBtn.classList.toggle('toggle-on', hintOn);
        boardEl.classList.toggle('hint-on', hintOn);
      });

      // „ÅäÊâãÊú¨: Êäº„Åó„Å¶„ÅÑ„ÇãÈñì„Å†„ÅëË°®Á§∫
      const showPreview = () => { previewOverlay.classList.add('show'); };
      const hidePreview = () => { previewOverlay.classList.remove('show'); };
      previewBtn.addEventListener('mousedown', showPreview);
      previewBtn.addEventListener('mouseup', hidePreview);
      previewBtn.addEventListener('mouseleave', hidePreview);
      previewBtn.addEventListener('touchstart', (e) => { e.preventDefault(); showPreview(); });
      previewBtn.addEventListener('touchend', hidePreview);
      previewBtn.addEventListener('touchcancel', hidePreview);

      clearPlayAgain.addEventListener('click', () => {
        clearMsg.classList.remove('show');
        newGame();
      });

      rankingBtn.addEventListener('click', () => {
        if (typeof Ranking !== 'undefined') {
          Ranking.showRankingModal(getRankingId());
        }
      });
    }

    function getRankingId() {
      return 'sliding-puzzle-' + gridSize + 'x' + gridSize;
    }

    // ===== „Ç≤„Éº„É†ÈñãÂßã =====
    function newGame() {
      stopTimer();
      moves = 0;
      seconds = 0;
      isPlaying = false;
      updateScoreDisplay();
      clearMsg.classList.remove('show');
      boardEl.classList.remove('completed');

      // „Ç§„É©„Çπ„ÉàÁîüÊàê
      generateImage();

      // „Çø„Ç§„É´ÂàùÊúüÂåñÔºàÂÆåÊàêÁä∂ÊÖãÔºâ
      const total = gridSize * gridSize;
      tiles = [];
      for (let i = 1; i < total; i++) tiles.push(i);
      tiles.push(0); // ÊúÄÂæå„ÅåÁ©∫„Åç

      // „Ç∑„É£„ÉÉ„Éï„É´
      shuffle();

      // ÊèèÁîª
      renderBoard();
    }

    function generateImage() {
      const size = 400;
      const canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      // ËÉåÊôØ
      ctx.fillStyle = '#faf5ff';
      ctx.fillRect(0, 0, size, size);

      // ÂãïÁâ©„ÇíÊèèÁîª
      ANIMALS[currentAnimal].draw(ctx, size);

      imageDataURL = canvas.toDataURL();

      // „Éó„É¨„Éì„É•„ÉºÁî®
      previewCanvas.width = size;
      previewCanvas.height = size;
      const pctx = previewCanvas.getContext('2d');
      pctx.drawImage(canvas, 0, 0);
    }

    // ===== „Ç∑„É£„ÉÉ„Éï„É´ÔºàÂÆüÈöõ„Å´„Çπ„É©„Ç§„Éâ„ÇíÁπ∞„ÇäËøî„ÅôÔºâ =====
    function shuffle() {
      const total = gridSize * gridSize;
      const shuffleMoves = gridSize * gridSize * 20;
      let emptyIdx = tiles.indexOf(0);
      let lastMove = -1;

      for (let i = 0; i < shuffleMoves; i++) {
        const neighbors = getNeighbors(emptyIdx);
        // Áõ¥Ââç„Å´Êàª„ÇãÂãï„Åç„ÇíÈÅø„Åë„Çã
        const filtered = neighbors.filter(n => n !== lastMove);
        const pick = filtered[Math.floor(Math.random() * filtered.length)];
        lastMove = emptyIdx;
        tiles[emptyIdx] = tiles[pick];
        tiles[pick] = 0;
        emptyIdx = pick;
      }
    }

    function getNeighbors(idx) {
      const row = Math.floor(idx / gridSize);
      const col = idx % gridSize;
      const result = [];
      if (row > 0) result.push(idx - gridSize);
      if (row < gridSize - 1) result.push(idx + gridSize);
      if (col > 0) result.push(idx - 1);
      if (col < gridSize - 1) result.push(idx + 1);
      return result;
    }

    // ===== ÊèèÁîª =====
    function renderBoard() {
      const boardSize = Math.min(340, window.innerWidth - 40);
      const tileSize = Math.floor((boardSize - (gridSize + 1) * 3) / gridSize);
      const actualSize = tileSize * gridSize + (gridSize + 1) * 3;

      boardEl.style.gridTemplateColumns = `repeat(${gridSize}, ${tileSize}px)`;
      boardEl.style.width = actualSize + 'px';
      boardEl.innerHTML = '';

      tiles.forEach((num, idx) => {
        const tile = document.createElement('div');
        tile.className = 'tile' + (num === 0 ? ' empty' : '');
        tile.style.width = tileSize + 'px';
        tile.style.height = tileSize + 'px';

        if (num !== 0) {
          // ÂÖÉ„ÅÆ‰ΩçÁΩÆ„Åã„ÇâËÉåÊôØ‰ΩçÁΩÆ„ÇíË®àÁÆó
          const origRow = Math.floor((num - 1) / gridSize);
          const origCol = (num - 1) % gridSize;
          tile.style.backgroundImage = `url(${imageDataURL})`;
          tile.style.backgroundSize = `${tileSize * gridSize}px ${tileSize * gridSize}px`;
          tile.style.backgroundPosition = `-${origCol * tileSize}px -${origRow * tileSize}px`;

          // „Éí„É≥„ÉàÁï™Âè∑
          const hint = document.createElement('span');
          hint.className = 'hint-num';
          hint.textContent = num;
          tile.appendChild(hint);

          tile.addEventListener('click', () => onTileClick(idx));
          tile.addEventListener('pointerdown', (e) => onPointerDown(e, idx));
          tile.addEventListener('pointermove', onPointerMove);
          tile.addEventListener('pointerup', onPointerUp);
          tile.addEventListener('pointercancel', onPointerUp);
        }

        boardEl.appendChild(tile);
      });

      boardEl.classList.toggle('hint-on', hintOn);
    }

    // ===== „Çø„Ç§„É´ÁßªÂãï =====
    function moveTile(idx) {
      if (boardEl.classList.contains('completed')) return;

      const emptyIdx = tiles.indexOf(0);
      const neighbors = getNeighbors(emptyIdx);

      if (!neighbors.includes(idx)) return;

      // „Çπ„ÉØ„ÉÉ„Éó
      tiles[emptyIdx] = tiles[idx];
      tiles[idx] = 0;
      moves++;

      // ÂàùÂõû„ÇØ„É™„ÉÉ„ÇØ„Åß„Çø„Ç§„Éû„ÉºÈñãÂßã
      if (!isPlaying) {
        isPlaying = true;
        startTimer();
      }

      updateScoreDisplay();
      renderBoard();

      // „ÇØ„É™„Ç¢Âà§ÂÆö
      if (checkWin()) {
        onClear();
      }
    }

    function onTileClick(idx) {
      if (dragDidMove) {
        dragDidMove = false;
        return;
      }
      moveTile(idx);
    }

    // ===== „Éâ„É©„ÉÉ„Ç∞Êìç‰Ωú =====
    function onPointerDown(e, tileIdx) {
      if (boardEl.classList.contains('completed')) return;

      const emptyIdx = tiles.indexOf(0);
      const neighbors = getNeighbors(emptyIdx);
      if (!neighbors.includes(tileIdx)) return;

      // „Çø„Ç§„É´„Åã„ÇâÁ©∫„Åç„Éû„Çπ„Å∏„ÅÆÊñπÂêë„ÇíÂà§ÂÆö
      const tileRow = Math.floor(tileIdx / gridSize);
      const tileCol = tileIdx % gridSize;
      const emptyRow = Math.floor(emptyIdx / gridSize);
      const emptyCol = emptyIdx % gridSize;

      let direction;
      if (emptyRow < tileRow) direction = 'up';
      else if (emptyRow > tileRow) direction = 'down';
      else if (emptyCol < tileCol) direction = 'left';
      else direction = 'right';

      const tileEl = e.currentTarget;
      const tileSize = tileEl.offsetWidth + 3; // „Çø„Ç§„É´ÂπÖ + gap

      dragState = {
        tileIdx,
        startX: e.clientX,
        startY: e.clientY,
        tileEl,
        direction,
        tileSize,
        lastDx: 0,
        lastDy: 0
      };
      dragDidMove = false;

      tileEl.classList.add('dragging');
      tileEl.setPointerCapture(e.pointerId);
    }

    function onPointerMove(e) {
      if (!dragState) return;

      let dx = e.clientX - dragState.startX;
      let dy = e.clientY - dragState.startY;
      const maxDist = dragState.tileSize;

      // Á©∫„Åç„Éû„Çπ„ÅÆÊñπÂêë„Å´„ÅÆ„ÅøÁßªÂãï„ÇíÂà∂Èôê
      switch (dragState.direction) {
        case 'up':
          dx = 0;
          dy = Math.max(-maxDist, Math.min(0, dy));
          break;
        case 'down':
          dx = 0;
          dy = Math.min(maxDist, Math.max(0, dy));
          break;
        case 'left':
          dy = 0;
          dx = Math.max(-maxDist, Math.min(0, dx));
          break;
        case 'right':
          dy = 0;
          dx = Math.min(maxDist, Math.max(0, dx));
          break;
      }

      dragState.tileEl.style.transform = `translate(${dx}px, ${dy}px)`;
      dragState.lastDx = dx;
      dragState.lastDy = dy;
    }

    function onPointerUp(e) {
      if (!dragState) return;

      const dist = Math.abs(dragState.lastDx) + Math.abs(dragState.lastDy);
      const tileIdx = dragState.tileIdx;
      const tileEl = dragState.tileEl;

      tileEl.classList.remove('dragging');
      tileEl.style.transform = '';
      dragState = null;

      if (dist >= SWIPE_THRESHOLD) {
        dragDidMove = true;
        moveTile(tileIdx);
      }
    }

    function checkWin() {
      const total = gridSize * gridSize;
      for (let i = 0; i < total - 1; i++) {
        if (tiles[i] !== i + 1) return false;
      }
      return tiles[total - 1] === 0;
    }

    // ===== „ÇØ„É™„Ç¢ =====
    function onClear() {
      stopTimer();
      isPlaying = false;

      // „Éú„Éº„ÉâÂÆåÊàêÊºîÂá∫ÔºàÊû†Á∑öÊ∂à„ÅôÔºâ
      boardEl.classList.add('completed');

      // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
      setTimeout(() => {
        clearStats.textContent = `${moves}Êâã Ôºè ${formatTime(seconds)}`;
        clearMsg.classList.add('show');
        spawnConfetti();

        // „É©„É≥„Ç≠„É≥„Ç∞ÁôªÈå≤
        if (typeof Ranking !== 'undefined') {
          setTimeout(() => {
            // ÊâãÊï∞„ÅåÂ∞ë„Å™„ÅÑ„Åª„ÅÜ„ÅåËâØ„ÅÑ„ÅÆ„Åß„ÄÅ„Çπ„Ç≥„Ç¢„ÅØÈÄÜËª¢„Åï„Åõ„ÇãÔºàÂ§ß„Åç„ÅÑ„Åª„Å©‰∏ä‰ΩçÔºâ
            // ÊúÄÂ§ßÊâãÊï∞„ÇíÂçÅÂàÜÂ§ß„Åç„ÅèË®≠ÂÆö„Åó„Å¶Âºï„Åè
            const maxScore = 99999;
            const score = maxScore - moves;
            Ranking.showSubmitModal(getRankingId(), score, () => {});
          }, 1500);
        }
      }, 800);
    }

    // ===== „Çø„Ç§„Éû„Éº =====
    function startTimer() {
      stopTimer();
      timerInterval = setInterval(() => {
        seconds++;
        timerEl.textContent = '‚è± ' + formatTime(seconds);
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return String(m).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
    }

    function updateScoreDisplay() {
      moveCountEl.textContent = 'ÊâãÊï∞: ' + moves;
      timerEl.textContent = '‚è± ' + formatTime(seconds);
    }

    // ===== Á¥ôÂêπÈõ™ =====
    function spawnConfetti() {
      const colors = ['#ff6b6b', '#ffd93d', '#6bcb77', '#4d96ff', '#ff6bd6', '#a66cff'];
      for (let i = 0; i < 50; i++) {
        const el = document.createElement('div');
        el.className = 'confetti';
        el.style.left = Math.random() * 100 + 'vw';
        el.style.top = '-10px';
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.width = (6 + Math.random() * 8) + 'px';
        el.style.height = (6 + Math.random() * 8) + 'px';
        el.style.animation = `confettiFall ${1.5 + Math.random() * 2}s ease-out forwards`;
        el.style.animationDelay = Math.random() * 0.5 + 's';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 4000);
      }
    }

    // ==========================================
    //  ÂãïÁâ©„Ç§„É©„Çπ„ÉàÊèèÁîªÈñ¢Êï∞
    // ==========================================

    function drawCat(ctx, s) {
      const cx = s / 2, cy = s / 2;

      // ‰Ωì
      ctx.fillStyle = '#ffb347';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.12, s * 0.28, s * 0.3, 0, 0, Math.PI * 2);
      ctx.fill();

      // ËÄ≥ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#ffb347';
      ctx.beginPath();
      ctx.moveTo(cx - s * 0.22, cy - s * 0.18);
      ctx.lineTo(cx - s * 0.12, cy - s * 0.38);
      ctx.lineTo(cx - s * 0.02, cy - s * 0.18);
      ctx.fill();
      // ËÄ≥„ÅÆ‰∏≠ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#ffcccb';
      ctx.beginPath();
      ctx.moveTo(cx - s * 0.19, cy - s * 0.18);
      ctx.lineTo(cx - s * 0.12, cy - s * 0.32);
      ctx.lineTo(cx - s * 0.05, cy - s * 0.18);
      ctx.fill();

      // ËÄ≥ÔºàÂè≥Ôºâ
      ctx.fillStyle = '#ffb347';
      ctx.beginPath();
      ctx.moveTo(cx + s * 0.02, cy - s * 0.18);
      ctx.lineTo(cx + s * 0.12, cy - s * 0.38);
      ctx.lineTo(cx + s * 0.22, cy - s * 0.18);
      ctx.fill();
      ctx.fillStyle = '#ffcccb';
      ctx.beginPath();
      ctx.moveTo(cx + s * 0.05, cy - s * 0.18);
      ctx.lineTo(cx + s * 0.12, cy - s * 0.32);
      ctx.lineTo(cx + s * 0.19, cy - s * 0.18);
      ctx.fill();

      // È°î
      ctx.fillStyle = '#ffcc80';
      ctx.beginPath();
      ctx.arc(cx, cy - s * 0.02, s * 0.22, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.08, cy - s * 0.06, s * 0.035, s * 0.045, 0, 0, Math.PI * 2);
      ctx.fill();
      // ÁõÆ„ÅÆ„Éè„Ç§„É©„Ç§„Éà
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.07, cy - s * 0.075, s * 0.012, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂè≥Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.08, cy - s * 0.06, s * 0.035, s * 0.045, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.09, cy - s * 0.075, s * 0.012, 0, Math.PI * 2);
      ctx.fill();

      // Èºª
      ctx.fillStyle = '#ff8a80';
      ctx.beginPath();
      ctx.moveTo(cx, cy + s * 0.01);
      ctx.lineTo(cx - s * 0.025, cy + s * 0.035);
      ctx.lineTo(cx + s * 0.025, cy + s * 0.035);
      ctx.fill();

      // Âè£
      ctx.strokeStyle = '#a0522d';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(cx, cy + s * 0.035);
      ctx.lineTo(cx - s * 0.04, cy + s * 0.07);
      ctx.moveTo(cx, cy + s * 0.035);
      ctx.lineTo(cx + s * 0.04, cy + s * 0.07);
      ctx.stroke();

      // „Å≤„ÅíÔºàÂ∑¶Ôºâ
      ctx.strokeStyle = '#888';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(cx - s * 0.1, cy + s * 0.01);
      ctx.lineTo(cx - s * 0.25, cy - s * 0.01);
      ctx.moveTo(cx - s * 0.1, cy + s * 0.035);
      ctx.lineTo(cx - s * 0.25, cy + s * 0.04);
      ctx.moveTo(cx - s * 0.1, cy + s * 0.06);
      ctx.lineTo(cx - s * 0.25, cy + s * 0.08);
      ctx.stroke();

      // „Å≤„ÅíÔºàÂè≥Ôºâ
      ctx.beginPath();
      ctx.moveTo(cx + s * 0.1, cy + s * 0.01);
      ctx.lineTo(cx + s * 0.25, cy - s * 0.01);
      ctx.moveTo(cx + s * 0.1, cy + s * 0.035);
      ctx.lineTo(cx + s * 0.25, cy + s * 0.04);
      ctx.moveTo(cx + s * 0.1, cy + s * 0.06);
      ctx.lineTo(cx + s * 0.25, cy + s * 0.08);
      ctx.stroke();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 150, 150, 0.35)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.15, cy + s * 0.04, s * 0.04, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.15, cy + s * 0.04, s * 0.04, 0, Math.PI * 2);
      ctx.fill();

      // „Åó„Å£„ÅΩ
      ctx.strokeStyle = '#ffb347';
      ctx.lineWidth = s * 0.03;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(cx + s * 0.2, cy + s * 0.3);
      ctx.quadraticCurveTo(cx + s * 0.38, cy + s * 0.15, cx + s * 0.3, cy + s * 0.0);
      ctx.stroke();
    }

    function drawDog(ctx, s) {
      const cx = s / 2, cy = s / 2;

      // ‰Ωì
      ctx.fillStyle = '#d4a574';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.12, s * 0.26, s * 0.28, 0, 0, Math.PI * 2);
      ctx.fill();

      // „Åü„ÇåËÄ≥ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#b08050';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.22, cy - s * 0.02, s * 0.08, s * 0.18, -0.2, 0, Math.PI * 2);
      ctx.fill();

      // „Åü„ÇåËÄ≥ÔºàÂè≥Ôºâ
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.22, cy - s * 0.02, s * 0.08, s * 0.18, 0.2, 0, Math.PI * 2);
      ctx.fill();

      // È°î
      ctx.fillStyle = '#ddb892';
      ctx.beginPath();
      ctx.arc(cx, cy - s * 0.02, s * 0.2, 0, Math.PI * 2);
      ctx.fill();

      // Âè£Âë®„ÇäÔºàÁôΩ„ÅÑÈÉ®ÂàÜÔºâ
      ctx.fillStyle = '#f5e6d3';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.06, s * 0.12, s * 0.1, 0, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx - s * 0.07, cy - s * 0.06, s * 0.03, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.06, cy - s * 0.07, s * 0.01, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂè≥Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx + s * 0.07, cy - s * 0.06, s * 0.03, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.08, cy - s * 0.07, s * 0.01, 0, Math.PI * 2);
      ctx.fill();

      // Èºª
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.02, s * 0.035, s * 0.025, 0, 0, Math.PI * 2);
      ctx.fill();

      // Ëàå„Éö„É≠
      ctx.fillStyle = '#ff8a9a';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.1, s * 0.03, s * 0.045, 0, 0, Math.PI * 2);
      ctx.fill();

      // Âè£
      ctx.strokeStyle = '#8b6f47';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(cx, cy + s * 0.035);
      ctx.lineTo(cx - s * 0.03, cy + s * 0.06);
      ctx.moveTo(cx, cy + s * 0.035);
      ctx.lineTo(cx + s * 0.03, cy + s * 0.06);
      ctx.stroke();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 150, 150, 0.3)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.14, cy + s * 0.03, s * 0.035, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.14, cy + s * 0.03, s * 0.035, 0, Math.PI * 2);
      ctx.fill();

      // „Åó„Å£„ÅΩ
      ctx.strokeStyle = '#d4a574';
      ctx.lineWidth = s * 0.035;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(cx + s * 0.18, cy + s * 0.28);
      ctx.quadraticCurveTo(cx + s * 0.35, cy + s * 0.1, cx + s * 0.28, cy - s * 0.02);
      ctx.stroke();
    }

    function drawRabbit(ctx, s) {
      const cx = s / 2, cy = s / 2 + s * 0.05;

      // ‰Ωì
      ctx.fillStyle = '#fff5f5';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.08, s * 0.24, s * 0.26, 0, 0, Math.PI * 2);
      ctx.fill();

      // ËÄ≥ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#fff5f5';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.1, cy - s * 0.32, s * 0.06, s * 0.18, -0.15, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#ffb6c1';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.1, cy - s * 0.3, s * 0.03, s * 0.12, -0.15, 0, Math.PI * 2);
      ctx.fill();

      // ËÄ≥ÔºàÂè≥Ôºâ
      ctx.fillStyle = '#fff5f5';
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.1, cy - s * 0.32, s * 0.06, s * 0.18, 0.15, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#ffb6c1';
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.1, cy - s * 0.3, s * 0.03, s * 0.12, 0.15, 0, Math.PI * 2);
      ctx.fill();

      // È°î
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx, cy - s * 0.04, s * 0.19, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#e74c6f';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.07, cy - s * 0.07, s * 0.025, s * 0.035, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.06, cy - s * 0.08, s * 0.01, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂè≥Ôºâ
      ctx.fillStyle = '#e74c6f';
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.07, cy - s * 0.07, s * 0.025, s * 0.035, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.08, cy - s * 0.08, s * 0.01, 0, Math.PI * 2);
      ctx.fill();

      // Èºª
      ctx.fillStyle = '#ff8a9a';
      ctx.beginPath();
      ctx.arc(cx, cy + s * 0.0, s * 0.02, 0, Math.PI * 2);
      ctx.fill();

      // Âè£
      ctx.strokeStyle = '#d4838f';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(cx, cy + s * 0.02);
      ctx.lineTo(cx - s * 0.025, cy + s * 0.045);
      ctx.moveTo(cx, cy + s * 0.02);
      ctx.lineTo(cx + s * 0.025, cy + s * 0.045);
      ctx.stroke();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 130, 150, 0.4)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.13, cy + s * 0.0, s * 0.04, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.13, cy + s * 0.0, s * 0.04, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawPanda(ctx, s) {
      const cx = s / 2, cy = s / 2;

      // ‰Ωì
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.1, s * 0.26, s * 0.28, 0, 0, Math.PI * 2);
      ctx.fill();

      // ËÄ≥ÔºàÂ∑¶„ÉªÈªíÔºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx - s * 0.17, cy - s * 0.2, s * 0.08, 0, Math.PI * 2);
      ctx.fill();

      // ËÄ≥ÔºàÂè≥„ÉªÈªíÔºâ
      ctx.beginPath();
      ctx.arc(cx + s * 0.17, cy - s * 0.2, s * 0.08, 0, Math.PI * 2);
      ctx.fill();

      // È°îÔºàÁôΩÔºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx, cy - s * 0.02, s * 0.21, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆ„ÅÆÂë®„ÇäÔºàÈªí„Éë„ÉÉ„ÉÅ„ÉªÂ∑¶Ôºâ
      ctx.fillStyle = '#333';
      ctx.save();
      ctx.translate(cx - s * 0.08, cy - s * 0.06);
      ctx.rotate(-0.3);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.055, s * 0.07, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // ÁõÆ„ÅÆÂë®„ÇäÔºàÈªí„Éë„ÉÉ„ÉÅ„ÉªÂè≥Ôºâ
      ctx.save();
      ctx.translate(cx + s * 0.08, cy - s * 0.06);
      ctx.rotate(0.3);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.055, s * 0.07, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // ÁõÆÔºàÁôΩ„ÉªÂ∑¶Ôºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.08, cy - s * 0.06, s * 0.025, 0, Math.PI * 2);
      ctx.fill();
      // ÁõÆÔºàÈªí„ÉªÂ∑¶Ôºâ
      ctx.fillStyle = '#111';
      ctx.beginPath();
      ctx.arc(cx - s * 0.08, cy - s * 0.055, s * 0.015, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÁôΩ„ÉªÂè≥Ôºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.08, cy - s * 0.06, s * 0.025, 0, Math.PI * 2);
      ctx.fill();
      // ÁõÆÔºàÈªí„ÉªÂè≥Ôºâ
      ctx.fillStyle = '#111';
      ctx.beginPath();
      ctx.arc(cx + s * 0.08, cy - s * 0.055, s * 0.015, 0, Math.PI * 2);
      ctx.fill();

      // Èºª
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.03, s * 0.03, s * 0.02, 0, 0, Math.PI * 2);
      ctx.fill();

      // Âè£
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(cx, cy + s * 0.045);
      ctx.lineTo(cx - s * 0.025, cy + s * 0.07);
      ctx.moveTo(cx, cy + s * 0.045);
      ctx.lineTo(cx + s * 0.025, cy + s * 0.07);
      ctx.stroke();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 150, 150, 0.3)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.14, cy + s * 0.04, s * 0.035, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.14, cy + s * 0.04, s * 0.035, 0, Math.PI * 2);
      ctx.fill();

      // Á¨π„ÅÆËëâ
      ctx.fillStyle = '#66bb6a';
      ctx.save();
      ctx.translate(cx + s * 0.28, cy - s * 0.05);
      ctx.rotate(0.5);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.02, s * 0.08, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.translate(s * 0.02, -s * 0.06);
      ctx.rotate(-0.6);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.015, s * 0.06, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    function drawFrog(ctx, s) {
      const cx = s / 2, cy = s / 2 + s * 0.02;

      // ‰Ωì
      ctx.fillStyle = '#66bb6a';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.08, s * 0.26, s * 0.26, 0, 0, Math.PI * 2);
      ctx.fill();

      // „ÅäËÖπ
      ctx.fillStyle = '#c8e6c9';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.12, s * 0.16, s * 0.17, 0, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆ„ÅÆÁ™ÅËµ∑ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#66bb6a';
      ctx.beginPath();
      ctx.arc(cx - s * 0.1, cy - s * 0.17, s * 0.09, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆ„ÅÆÁ™ÅËµ∑ÔºàÂè≥Ôºâ
      ctx.beginPath();
      ctx.arc(cx + s * 0.1, cy - s * 0.17, s * 0.09, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÁôΩ„ÉªÂ∑¶Ôºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.1, cy - s * 0.17, s * 0.065, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÈªí„ÉªÂ∑¶Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx - s * 0.1, cy - s * 0.16, s * 0.035, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.09, cy - s * 0.175, s * 0.012, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÁôΩ„ÉªÂè≥Ôºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.1, cy - s * 0.17, s * 0.065, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÈªí„ÉªÂè≥Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx + s * 0.1, cy - s * 0.16, s * 0.035, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.11, cy - s * 0.175, s * 0.012, 0, Math.PI * 2);
      ctx.fill();

      // „Å´„Å£„Åì„ÇäÂè£
      ctx.strokeStyle = '#388e3c';
      ctx.lineWidth = 2.5;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.arc(cx, cy + s * 0.02, s * 0.1, 0.15, Math.PI - 0.15);
      ctx.stroke();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 150, 130, 0.35)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.17, cy + s * 0.0, s * 0.04, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.17, cy + s * 0.0, s * 0.04, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawPenguin(ctx, s) {
      const cx = s / 2, cy = s / 2 + s * 0.02;

      // ‰ΩìÔºàÈªíÔºâ
      ctx.fillStyle = '#37474f';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.05, s * 0.24, s * 0.3, 0, 0, Math.PI * 2);
      ctx.fill();

      // „ÅäËÖπÔºàÁôΩÔºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.ellipse(cx, cy + s * 0.08, s * 0.16, s * 0.22, 0, 0, Math.PI * 2);
      ctx.fill();

      // È°î
      ctx.fillStyle = '#37474f';
      ctx.beginPath();
      ctx.arc(cx, cy - s * 0.1, s * 0.17, 0, Math.PI * 2);
      ctx.fill();

      // È°îÔºàÁôΩ„ÅÑÈÉ®ÂàÜÔºâ
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.ellipse(cx, cy - s * 0.06, s * 0.13, s * 0.1, 0, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx - s * 0.06, cy - s * 0.08, s * 0.022, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx - s * 0.055, cy - s * 0.09, s * 0.008, 0, Math.PI * 2);
      ctx.fill();

      // ÁõÆÔºàÂè≥Ôºâ
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(cx + s * 0.06, cy - s * 0.08, s * 0.022, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(cx + s * 0.065, cy - s * 0.09, s * 0.008, 0, Math.PI * 2);
      ctx.fill();

      // „Åè„Å°„Å∞„Åó
      ctx.fillStyle = '#ff9800';
      ctx.beginPath();
      ctx.moveTo(cx, cy - s * 0.04);
      ctx.lineTo(cx - s * 0.035, cy - s * 0.01);
      ctx.lineTo(cx + s * 0.035, cy - s * 0.01);
      ctx.fill();

      // „Åª„Å£„Å∫
      ctx.fillStyle = 'rgba(255, 130, 130, 0.4)';
      ctx.beginPath();
      ctx.arc(cx - s * 0.1, cy - s * 0.04, s * 0.03, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(cx + s * 0.1, cy - s * 0.04, s * 0.03, 0, Math.PI * 2);
      ctx.fill();

      // ÊâãÁæΩÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#37474f';
      ctx.save();
      ctx.translate(cx - s * 0.22, cy + s * 0.02);
      ctx.rotate(-0.2);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.05, s * 0.14, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // ÊâãÁæΩÔºàÂè≥Ôºâ
      ctx.save();
      ctx.translate(cx + s * 0.22, cy + s * 0.02);
      ctx.rotate(0.2);
      ctx.beginPath();
      ctx.ellipse(0, 0, s * 0.05, s * 0.14, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // Ë∂≥ÔºàÂ∑¶Ôºâ
      ctx.fillStyle = '#ff9800';
      ctx.beginPath();
      ctx.ellipse(cx - s * 0.08, cy + s * 0.32, s * 0.06, s * 0.025, -0.2, 0, Math.PI * 2);
      ctx.fill();

      // Ë∂≥ÔºàÂè≥Ôºâ
      ctx.beginPath();
      ctx.ellipse(cx + s * 0.08, cy + s * 0.32, s * 0.06, s * 0.025, 0.2, 0, Math.PI * 2);
      ctx.fill();
    }

    // ===== Ëµ∑Âãï =====
    init();
  })();
  </script>
</body>
</html>
