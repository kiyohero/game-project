<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>2048</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #faf8ef; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; touch-action: none; user-select: none; -webkit-user-select: none; }
    h1 { font-size: 3rem; color: #776e65; margin-bottom: 10px; }
    .header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; width: 100%; max-width: 340px; justify-content: space-between; }
    .score-container { background: #bbada0; padding: 10px 20px; border-radius: 6px; text-align: center; }
    .score-label { font-size: 0.7rem; color: #eee4da; text-transform: uppercase; font-weight: bold; }
    .score-value { font-size: 1.5rem; color: white; font-weight: bold; }
    .btn { background: #8f7a66; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 1rem; font-weight: bold; cursor: pointer; }
    .btn:active { transform: scale(0.95); }
    .grid-container { background: #bbada0; padding: 10px; border-radius: 6px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .cell { width: 75px; height: 75px; background: rgba(238,228,218,0.35); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; color: #776e65; transition: all 0.1s; }
    .cell[data-value="2"] { background: #eee4da; }
    .cell[data-value="4"] { background: #ede0c8; }
    .cell[data-value="8"] { background: #f2b179; color: #f9f6f2; }
    .cell[data-value="16"] { background: #f59563; color: #f9f6f2; }
    .cell[data-value="32"] { background: #f67c5f; color: #f9f6f2; }
    .cell[data-value="64"] { background: #f65e3b; color: #f9f6f2; }
    .cell[data-value="128"] { background: #edcf72; color: #f9f6f2; font-size: 1.5rem; }
    .cell[data-value="256"] { background: #edcc61; color: #f9f6f2; font-size: 1.5rem; }
    .cell[data-value="512"] { background: #edc850; color: #f9f6f2; font-size: 1.5rem; }
    .cell[data-value="1024"] { background: #edc53f; color: #f9f6f2; font-size: 1.3rem; }
    .cell[data-value="2048"] { background: #edc22e; color: #f9f6f2; font-size: 1.3rem; }
    .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.8); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .overlay.show { opacity: 1; pointer-events: auto; }
    .overlay h2 { font-size: 2.5rem; color: #776e65; margin-bottom: 20px; }
    .overlay .final-score { font-size: 1.2rem; color: #776e65; margin-bottom: 20px; }
    .instructions { color: #776e65; margin-top: 15px; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>2048</h1>
  <div class="header">
    <div class="score-container">
      <div class="score-label">スコア</div>
      <div class="score-value" id="score">0</div>
    </div>
    <button class="btn" id="restart">リトライ</button>
  </div>
  <div class="grid-container" id="grid"></div>
  <p class="instructions">スワイプまたは矢印キーで操作</p>
  <div class="overlay" id="overlay">
    <h2 id="message">ゲームオーバー</h2>
    <p class="final-score">スコア: <span id="finalScore">0</span></p>
    <button class="btn" id="retryBtn">もう一度</button>
  </div>
  <script>
    const gridEl=document.getElementById('grid'),scoreEl=document.getElementById('score'),overlay=document.getElementById('overlay'),messageEl=document.getElementById('message'),finalScoreEl=document.getElementById('finalScore');let grid=[],score=0;function init(){grid=Array(4).fill(null).map(()=>Array(4).fill(0));score=0;scoreEl.textContent='0';overlay.classList.remove('show');addRandomTile();addRandomTile();render()}function addRandomTile(){const empty=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(grid[r][c]===0)empty.push({r,c});if(empty.length===0)return;const{r,c}=empty[Math.floor(Math.random()*empty.length)];grid[r][c]=Math.random()<0.9?2:4}function render(){gridEl.innerHTML='';for(let r=0;r<4;r++)for(let c=0;c<4;c++){const cell=document.createElement('div');cell.classList.add('cell');const val=grid[r][c];if(val!==0){cell.textContent=val;cell.dataset.value=val}gridEl.appendChild(cell)}}function slide(row){let arr=row.filter(v=>v!==0);for(let i=0;i<arr.length-1;i++)if(arr[i]===arr[i+1]){arr[i]*=2;score+=arr[i];arr[i+1]=0}arr=arr.filter(v=>v!==0);while(arr.length<4)arr.push(0);return arr}function move(direction){const oldGrid=JSON.stringify(grid);if(direction==='left')for(let r=0;r<4;r++)grid[r]=slide(grid[r]);else if(direction==='right')for(let r=0;r<4;r++)grid[r]=slide(grid[r].reverse()).reverse();else if(direction==='up')for(let c=0;c<4;c++){let col=[grid[0][c],grid[1][c],grid[2][c],grid[3][c]];col=slide(col);for(let r=0;r<4;r++)grid[r][c]=col[r]}else if(direction==='down')for(let c=0;c<4;c++){let col=[grid[0][c],grid[1][c],grid[2][c],grid[3][c]].reverse();col=slide(col).reverse();for(let r=0;r<4;r++)grid[r][c]=col[r]}if(JSON.stringify(grid)!==oldGrid){addRandomTile();scoreEl.textContent=score;render();for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(grid[r][c]===2048){setTimeout(()=>showOverlay('2048達成！'),200);return}if(isGameOver())setTimeout(()=>showOverlay('ゲームオーバー'),200)}}function isGameOver(){for(let r=0;r<4;r++)for(let c=0;c<4;c++){if(grid[r][c]===0)return false;if(c<3&&grid[r][c]===grid[r][c+1])return false;if(r<3&&grid[r][c]===grid[r+1][c])return false}return true}function showOverlay(msg){messageEl.textContent=msg;finalScoreEl.textContent=score;overlay.classList.add('show')}document.addEventListener('keydown',e=>{if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)){e.preventDefault();move(e.key.replace('Arrow','').toLowerCase())}});let touchStartX=0,touchStartY=0;document.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY},{passive:true});document.addEventListener('touchend',e=>{if(!touchStartX||!touchStartY)return;const dx=e.changedTouches[0].clientX-touchStartX,dy=e.changedTouches[0].clientY-touchStartY;if(Math.abs(dx)>Math.abs(dy)){if(Math.abs(dx)>30)move(dx>0?'right':'left')}else if(Math.abs(dy)>30)move(dy>0?'down':'up');touchStartX=0;touchStartY=0},{passive:true});document.getElementById('restart').addEventListener('click',init);document.getElementById('retryBtn').addEventListener('click',init);init();
  </script>
</body>
</html>
